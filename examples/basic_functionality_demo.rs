//! # MPC API åŸºç¡€åŠŸèƒ½æ¼”ç¤ºæŒ‡å—
//! 
//! æœ¬æ–‡ä»¶æä¾›äº†ä¸€ä¸ªå…¨é¢çš„ MPC (Multi-Party Computation) API åŸºç¡€åŠŸèƒ½æ¼”ç¤ºï¼Œ
//! ä¸“ä¸ºåˆå­¦è€…å’Œå¸Œæœ›å¿«é€Ÿä¸Šæ‰‹çš„å¼€å‘è€…è®¾è®¡ã€‚é€šè¿‡å®é™…å¯è¿è¡Œçš„ä»£ç ç¤ºä¾‹ï¼Œ
//! å±•ç¤ºå®‰å…¨å¤šæ–¹è®¡ç®—çš„æ ¸å¿ƒæ¦‚å¿µå’ŒåŸºç¡€æ“ä½œã€‚
//! 
//! ## ğŸ¯ å­¦ä¹ ç›®æ ‡
//! 
//! é€šè¿‡æœ¬æ¼”ç¤ºï¼Œæ‚¨å°†æŒæ¡ï¼š
//! - **æœ‰é™åŸŸè¿ç®—**: å¯†ç å­¦è®¡ç®—çš„æ•°å­¦åŸºç¡€ï¼ŒåŒ…æ‹¬åŠ æ³•ã€å‡æ³•ã€ä¹˜æ³•å’Œé€†å…ƒè¿ç®—
//! - **ç§˜å¯†åˆ†äº«æœºåˆ¶**: Shamir ç§˜å¯†åˆ†äº«çš„å®Œæ•´æµç¨‹ï¼Œä»åˆ†äº«ç”Ÿæˆåˆ°é‡æ„
//! - **Beaver ä¸‰å…ƒç»„**: å®‰å…¨ä¹˜æ³•çš„æ ¸å¿ƒé¢„å¤„ç†ææ–™åŠå…¶åº”ç”¨
//! - **æ‰¿è¯ºæ–¹æ¡ˆ**: å“ˆå¸Œæ‰¿è¯ºçš„åˆ›å»ºã€éªŒè¯å’Œéšç§ä¿æŠ¤ç‰¹æ€§
//! - **Merkle æ ‘**: æ•°æ®å®Œæ•´æ€§è¯æ˜å’ŒåŒ…å«æ€§éªŒè¯æŠ€æœ¯
//! 
//! ## ğŸ”’ å¯†ç å­¦åŸºç¡€æ¦‚å¿µ
//! 
//! ### æœ‰é™åŸŸ (Finite Field)
//! 
//! æœ‰é™åŸŸæ˜¯å¯†ç å­¦çš„æ•°å­¦åŸºç¡€ï¼Œæ‰€æœ‰è¿ç®—éƒ½åœ¨æ¨¡ p æ„ä¹‰ä¸‹è¿›è¡Œï¼Œå…¶ä¸­ p æ˜¯ä¸€ä¸ªå¤§ç´ æ•°ã€‚
//! è¿™ç¡®ä¿äº†ï¼š
//! - **ç¡®å®šæ€§**: è¿ç®—ç»“æœå”¯ä¸€ä¸”å¯é‡ç°
//! - **å®‰å…¨æ€§**: å¤§ç´ æ•°æä¾›è¶³å¤Ÿçš„è®¡ç®—å®‰å…¨æ€§
//! - **æ•ˆç‡æ€§**: æ¨¡è¿ç®—å…·æœ‰è‰¯å¥½çš„è®¡ç®—æ€§èƒ½
//! 
//! ### ç§˜å¯†åˆ†äº« (Secret Sharing)
//! 
//! Shamir ç§˜å¯†åˆ†äº«å°†ç§˜å¯† s åˆ†è§£ä¸º n ä¸ªåˆ†äº«ï¼Œæ»¡è¶³ï¼š
//! - ä»»æ„ t ä¸ªåˆ†äº«å¯ä»¥é‡æ„åŸå§‹ç§˜å¯†
//! - å°‘äº t ä¸ªåˆ†äº«æ— æ³•è·å¾—ç§˜å¯†çš„ä»»ä½•ä¿¡æ¯
//! - åŸºäºå¤šé¡¹å¼æ’å€¼çš„æ•°å­¦åŸç†
//! 
//! ### Beaver ä¸‰å…ƒç»„ (Beaver Triples)
//! 
//! Beaver ä¸‰å…ƒç»„ (a, b, c) æ»¡è¶³ c = a Ã— bï¼Œç”¨äºå®‰å…¨ä¹˜æ³•ï¼š
//! - **é¢„å¤„ç†**: åœ¨ç¦»çº¿é˜¶æ®µç”Ÿæˆï¼Œä¸ä¾èµ–å®é™…è¾“å…¥
//! - **é«˜æ•ˆæ€§**: åœ¨çº¿é˜¶æ®µåªéœ€å¸¸æ•°è½®é€šä¿¡
//! - **é€šç”¨æ€§**: å¯ç”¨äºä»»æ„ä¸¤ä¸ªç§˜å¯†å€¼çš„ä¹˜æ³•
//! 
//! ## ğŸš€ åº”ç”¨åœºæ™¯
//! 
//! - **éšç§ä¿æŠ¤æœºå™¨å­¦ä¹ **: å¤šæ–¹è”åˆè®­ç»ƒè€Œä¸æ³„éœ²æ•°æ®
//! - **é‡‘èé£æ§**: é“¶è¡Œé—´è”åˆé£é™©è¯„ä¼°
//! - **åŒ»ç–—æ•°æ®åˆ†æ**: åŒ»é™¢é—´åä½œç ”ç©¶ä¿æŠ¤æ‚£è€…éšç§
//! - **ä¾›åº”é“¾åä½œ**: ä¼ä¸šé—´ä¿¡æ¯å…±äº«è€Œä¸æ³„éœ²å•†ä¸šæœºå¯†
//! 
//! ## ğŸ“Š æ€§èƒ½ç‰¹ç‚¹
//! 
//! - **æœ‰é™åŸŸè¿ç®—**: O(1) æ—¶é—´å¤æ‚åº¦ï¼Œé«˜åº¦ä¼˜åŒ–
//! - **ç§˜å¯†åˆ†äº«**: O(n) åˆ†äº«ç”Ÿæˆï¼ŒO(t) é‡æ„å¤æ‚åº¦
//! - **Beaver ä¸‰å…ƒç»„**: ä¸€æ¬¡æ€§é¢„å¤„ç†ï¼Œå¤šæ¬¡é«˜æ•ˆä½¿ç”¨
//! - **æ‰¿è¯ºæ–¹æ¡ˆ**: O(1) æ‰¿è¯ºå’ŒéªŒè¯æ“ä½œ
//! - **Merkle æ ‘**: O(log n) è¯æ˜ç”Ÿæˆå’ŒéªŒè¯

use mpc_api::{*, Result};
use mpc_api::secret_sharing::FIELD_PRIME;

/// æœ‰é™åŸŸè¿ç®—åŸºç¡€æ¼”ç¤º
/// 
/// ## ğŸ¯ åŠŸèƒ½æ¦‚è¿°
/// 
/// æœ¬å‡½æ•°å±•ç¤ºæœ‰é™åŸŸ F_p ä¸­çš„åŸºæœ¬ç®—æœ¯è¿ç®—ï¼Œè¿™æ˜¯æ‰€æœ‰å¯†ç å­¦åè®®çš„æ•°å­¦åŸºç¡€ã€‚
/// æœ‰é™åŸŸç¡®ä¿æ‰€æœ‰è¿ç®—éƒ½åœ¨ä¸€ä¸ªå°é—­çš„ã€æœ‰é™çš„æ•°å­¦ç»“æ„ä¸­è¿›è¡Œã€‚
/// 
/// ## ğŸ“š æ•°å­¦èƒŒæ™¯
/// 
/// ### æœ‰é™åŸŸçš„å®šä¹‰
/// æœ‰é™åŸŸ F_p æ˜¯ç”±ç´ æ•° p å®šä¹‰çš„é›†åˆ {0, 1, 2, ..., p-1}ï¼Œå…·æœ‰ä»¥ä¸‹æ€§è´¨ï¼š
/// - **åŠ æ³•**: (a + b) mod p
/// - **å‡æ³•**: (a - b + p) mod p  
/// - **ä¹˜æ³•**: (a Ã— b) mod p
/// - **é€†å…ƒ**: a^(-1) æ»¡è¶³ (a Ã— a^(-1)) mod p = 1
/// 
/// ### ä¸ºä»€ä¹ˆä½¿ç”¨æœ‰é™åŸŸï¼Ÿ
/// 
/// 1. **ç¡®å®šæ€§**: æ‰€æœ‰è¿ç®—ç»“æœéƒ½åœ¨æœ‰é™èŒƒå›´å†…
/// 2. **å®‰å…¨æ€§**: å¤§ç´ æ•° p æä¾›å¯†ç å­¦å®‰å…¨æ€§
/// 3. **æ•ˆç‡æ€§**: æ¨¡è¿ç®—å¯ä»¥é«˜æ•ˆå®ç°
/// 4. **ä»£æ•°ç»“æ„**: æ»¡è¶³äº¤æ¢å¾‹ã€ç»“åˆå¾‹ã€åˆ†é…å¾‹
/// 
/// ## ğŸ”’ å¯†ç å­¦é‡è¦æ€§
/// 
/// - **æ¤­åœ†æ›²çº¿å¯†ç **: åŸºäºæœ‰é™åŸŸä¸Šçš„æ¤­åœ†æ›²çº¿
/// - **ç§˜å¯†åˆ†äº«**: å¤šé¡¹å¼ç³»æ•°åœ¨æœ‰é™åŸŸä¸­é€‰æ‹©
/// - **åŒæ€åŠ å¯†**: å¯†æ–‡è¿ç®—å¯¹åº”æ˜æ–‡çš„æœ‰é™åŸŸè¿ç®—
/// - **é›¶çŸ¥è¯†è¯æ˜**: è¯æ˜å’ŒéªŒè¯éƒ½åœ¨æœ‰é™åŸŸä¸­è¿›è¡Œ
/// 
/// ## ğŸ’¡ å®é™…åº”ç”¨
/// 
/// - ç¡®ä¿è®¡ç®—çš„ä¸€è‡´æ€§å’Œå¯é‡ç°æ€§
/// - é˜²æ­¢æ•´æ•°æº¢å‡ºå’Œæ•°å€¼ä¸ç¨³å®š
/// - æ”¯æŒé«˜æ•ˆçš„æ¨¡è¿ç®—ç¡¬ä»¶åŠ é€Ÿ
/// - ä¸æ ‡å‡†å¯†ç å­¦ç®—æ³•å…¼å®¹
pub fn field_operations_demo() -> Result<()> {
    println!("=== æœ‰é™åŸŸè¿ç®—åŸºç¡€æ¼”ç¤º ===");
    
    // å±•ç¤ºå½“å‰ä½¿ç”¨çš„æœ‰é™åŸŸç´ æ•°
    // è¿™ä¸ªç´ æ•°çš„é€‰æ‹©å½±å“å®‰å…¨æ€§å’Œæ€§èƒ½
    println!("ğŸ”¢ å½“å‰æœ‰é™åŸŸç´ æ•°: {}", FIELD_PRIME);
    println!("  äºŒè¿›åˆ¶ä½æ•°: {} ä½", (FIELD_PRIME as f64).log2().ceil() as u32);
    println!("  å®‰å…¨ç­‰çº§: å¤§çº¦ {} ä½å®‰å…¨å¼ºåº¦", (FIELD_PRIME as f64).log2().ceil() as u32 / 2);
    
    // é€‰æ‹©ä¸¤ä¸ªç¤ºä¾‹æ“ä½œæ•°
    let a = 12345u64;
    let b = 67890u64;
    
    println!("\nğŸ§® é€‰æ‹©æµ‹è¯•æ“ä½œæ•°:");
    println!("  a = {} (åå…­è¿›åˆ¶: 0x{:x})", a, a);
    println!("  b = {} (åå…­è¿›åˆ¶: 0x{:x})", b, b);
    
    // === åŸºæœ¬ç®—æœ¯è¿ç®—æ¼”ç¤º ===
    println!("\nâ• æœ‰é™åŸŸåŸºæœ¬è¿ç®—:");
    
    // 1. åŠ æ³•è¿ç®—: (a + b) mod p
    let sum = field_add(a, b);
    println!("  åŠ æ³•: {} + {} â‰¡ {} (mod {})", a, b, sum, FIELD_PRIME);
    // éªŒè¯ï¼šæ™®é€šåŠ æ³•ä¸æ¨¡è¿ç®—çš„å…³ç³»
    let normal_sum = (a + b) % FIELD_PRIME;
    assert_eq!(sum, normal_sum, "æœ‰é™åŸŸåŠ æ³•åº”è¯¥ç­‰äºæ™®é€šæ¨¡åŠ æ³•");
    
    // 2. å‡æ³•è¿ç®—: (a - b + p) mod p  
    let difference = field_sub(a, b);
    println!("  å‡æ³•: {} - {} â‰¡ {} (mod {})", a, b, difference, FIELD_PRIME);
    // éªŒè¯ï¼šå‡æ³•çš„æ­£ç¡®æ€§
    let verification = field_add(difference, b);
    assert_eq!(verification, a, "å‡æ³•éªŒè¯: (a - b) + b = a");
    
    // 3. ä¹˜æ³•è¿ç®—: (a Ã— b) mod p
    let product = field_mul(a, b);
    println!("  ä¹˜æ³•: {} Ã— {} â‰¡ {} (mod {})", a, b, product, FIELD_PRIME);
    // éªŒè¯ï¼šæ™®é€šä¹˜æ³•ä¸æ¨¡è¿ç®—çš„å…³ç³»
    let normal_product = ((a as u128 * b as u128) % FIELD_PRIME as u128) as u64;
    assert_eq!(product, normal_product, "æœ‰é™åŸŸä¹˜æ³•åº”è¯¥ç­‰äºæ™®é€šæ¨¡ä¹˜æ³•");
    
    // === ä¹˜æ³•é€†å…ƒæ¼”ç¤º ===
    println!("\nğŸ”„ ä¹˜æ³•é€†å…ƒè¿ç®—:");
    
    // è®¡ç®— a çš„ä¹˜æ³•é€†å…ƒ
    if let Some(a_inv) = field_inv(a) {
        println!("  {} çš„ä¹˜æ³•é€†å…ƒ: {}", a, a_inv);
        
        // éªŒè¯é€†å…ƒçš„æ­£ç¡®æ€§: a Ã— a^(-1) â‰¡ 1 (mod p)
        let should_be_one = field_mul(a, a_inv);
        println!("  éªŒè¯: {} Ã— {} â‰¡ {} (mod {})", a, a_inv, should_be_one, FIELD_PRIME);
        assert_eq!(should_be_one, 1, "ä¹˜æ³•é€†å…ƒéªŒè¯å¤±è´¥");
        println!("  âœ… ä¹˜æ³•é€†å…ƒéªŒè¯é€šè¿‡");
        
        // å±•ç¤ºé€†å…ƒçš„å”¯ä¸€æ€§
        println!("  ğŸ’¡ æ•°å­¦æ€§è´¨: åœ¨æœ‰é™åŸŸä¸­ï¼Œé™¤0å¤–æ¯ä¸ªå…ƒç´ éƒ½æœ‰å”¯ä¸€çš„ä¹˜æ³•é€†å…ƒ");
    } else {
        // è¿™ç§æƒ…å†µä¸åº”è¯¥å‘ç”Ÿï¼Œå› ä¸º a â‰  0 ä¸” FIELD_PRIME æ˜¯ç´ æ•°
        println!("  âŒ æ— æ³•æ‰¾åˆ° {} çš„ä¹˜æ³•é€†å…ƒ", a);
    }
    
    // === æœ‰é™åŸŸæ€§è´¨éªŒè¯ ===
    println!("\nğŸ” æœ‰é™åŸŸä»£æ•°æ€§è´¨éªŒè¯:");
    
    // 1. äº¤æ¢å¾‹éªŒè¯
    let ab = field_mul(a, b);
    let ba = field_mul(b, a);
    assert_eq!(ab, ba, "ä¹˜æ³•äº¤æ¢å¾‹éªŒè¯å¤±è´¥");
    println!("  âœ… ä¹˜æ³•äº¤æ¢å¾‹: a Ã— b = b Ã— a");
    
    // 2. åˆ†é…å¾‹éªŒè¯  
    let c = 98765u64;
    let left = field_mul(a, field_add(b, c));   // a Ã— (b + c)
    let right = field_add(field_mul(a, b), field_mul(a, c)); // a Ã— b + a Ã— c
    assert_eq!(left, right, "åˆ†é…å¾‹éªŒè¯å¤±è´¥");
    println!("  âœ… åˆ†é…å¾‹: a Ã— (b + c) = a Ã— b + a Ã— c");
    
    // 3. é›¶å…ƒå’Œå•ä½å…ƒéªŒè¯
    let zero_result = field_add(a, 0);
    assert_eq!(zero_result, a, "åŠ æ³•é›¶å…ƒéªŒè¯å¤±è´¥");
    let one_result = field_mul(a, 1);
    assert_eq!(one_result, a, "ä¹˜æ³•å•ä½å…ƒéªŒè¯å¤±è´¥");
    println!("  âœ… é›¶å…ƒæ€§è´¨: a + 0 = a");
    println!("  âœ… å•ä½å…ƒæ€§è´¨: a Ã— 1 = a");
    
    // === å®é™…åº”ç”¨ç¤ºä¾‹ ===
    println!("\nğŸ¯ å®é™…åº”ç”¨ç¤ºä¾‹:");
    println!("  â€¢ æ¤­åœ†æ›²çº¿ç‚¹è¿ç®—: åæ ‡åœ¨æœ‰é™åŸŸä¸­è®¡ç®—");
    println!("  â€¢ ç§˜å¯†åˆ†äº«å¤šé¡¹å¼: ç³»æ•°å’Œæ±‚å€¼éƒ½åœ¨æœ‰é™åŸŸä¸­");
    println!("  â€¢ åŒæ€åŠ å¯†è¿ç®—: å¯†æ–‡è¿ç®—å¯¹åº”æœ‰é™åŸŸè¿ç®—");
    println!("  â€¢ æ•°å­—ç­¾åç®—æ³•: ç­¾åè®¡ç®—ä½¿ç”¨æœ‰é™åŸŸç®—æœ¯");
    
    println!("\nâœ… æœ‰é™åŸŸè¿ç®—æ¼”ç¤ºå®Œæˆ");
    println!("ğŸ’¡ å…³é”®è¦ç‚¹:");
    println!("  1. æ‰€æœ‰è¿ç®—éƒ½åœ¨æ¨¡ {} æ„ä¹‰ä¸‹è¿›è¡Œ", FIELD_PRIME);
    println!("  2. ç»“æœæ€»æ˜¯åœ¨ [0, {}) èŒƒå›´å†…", FIELD_PRIME);
    println!("  3. æ»¡è¶³æ‰€æœ‰ä»£æ•°è¿ç®—æ³•åˆ™ï¼ˆäº¤æ¢å¾‹ã€ç»“åˆå¾‹ã€åˆ†é…å¾‹ï¼‰");
    println!("  4. ä¸ºä¸Šå±‚å¯†ç å­¦åè®®æä¾›æ•°å­¦åŸºç¡€\n");
    
    Ok(())
}

/// Shamir ç§˜å¯†åˆ†äº«æœºåˆ¶è¯¦ç»†æ¼”ç¤º
/// 
/// ## ğŸ¯ åŠŸèƒ½æ¦‚è¿°
/// 
/// æœ¬å‡½æ•°æ¼”ç¤º Shamir ç§˜å¯†åˆ†äº«æ–¹æ¡ˆçš„å®Œæ•´æµç¨‹ï¼Œè¿™æ˜¯å®‰å…¨å¤šæ–¹è®¡ç®—çš„æ ¸å¿ƒæŠ€æœ¯ã€‚
/// é€šè¿‡å¤šé¡¹å¼æ’å€¼çš„æ•°å­¦åŸç†ï¼Œå°†ä¸€ä¸ªç§˜å¯†å®‰å…¨åœ°åˆ†é…ç»™å¤šä¸ªå‚ä¸æ–¹ã€‚
/// 
/// ## ğŸ“š ç®—æ³•åŸç†
/// 
/// ### Shamir ç§˜å¯†åˆ†äº«çš„æ•°å­¦åŸºç¡€
/// 
/// ç»™å®šç§˜å¯† sï¼Œé€‰æ‹© t-1 æ¬¡å¤šé¡¹å¼ f(x) = s + aâ‚x + aâ‚‚xÂ² + ... + aâ‚œâ‚‹â‚x^(t-1)
/// å…¶ä¸­ï¼š
/// - f(0) = s (ç§˜å¯†å€¼)
/// - ç³»æ•° aâ‚, aâ‚‚, ..., aâ‚œâ‚‹â‚ éšæœºé€‰æ‹©
/// - æ¯ä¸ªå‚ä¸æ–¹ i è·å¾—åˆ†äº« (i, f(i))
/// 
/// ### é—¨é™é‡æ„åŸç†
/// 
/// - **é—¨é™æ€§è´¨**: ä»»æ„ t ä¸ªåˆ†äº«å¯ä»¥é€šè¿‡æ‹‰æ ¼æœ—æ—¥æ’å€¼é‡æ„ç§˜å¯†
/// - **éšç§æ€§è´¨**: å°‘äº t ä¸ªåˆ†äº«æ— æ³•è·å¾—ç§˜å¯†çš„ä»»ä½•ä¿¡æ¯
/// - **çº¿æ€§æ€§è´¨**: åˆ†äº«çš„è¿ç®—å¯¹åº”ç§˜å¯†çš„è¿ç®—
/// 
/// ## ğŸ”’ å®‰å…¨ä¿è¯
/// 
/// 1. **å®Œç¾ç§˜å¯†æ€§**: ä¿¡æ¯è®ºå®‰å…¨ï¼Œå¯¹æŠ—è®¡ç®—æ— ç•Œæ•Œæ‰‹
/// 2. **é—¨é™æ§åˆ¶**: ç²¾ç¡®æ§åˆ¶é‡æ„æ‰€éœ€çš„æœ€å°‘å‚ä¸æ–¹æ•°é‡
/// 3. **å¯éªŒè¯æ€§**: å¯ä»¥éªŒè¯åˆ†äº«çš„æœ‰æ•ˆæ€§å’Œä¸€è‡´æ€§
/// 4. **å®¹é”™æ€§**: å¯ä»¥å®¹å¿éƒ¨åˆ†å‚ä¸æ–¹ç¦»çº¿æˆ–æ•…éšœ
/// 
/// ## ğŸš€ åº”ç”¨åœºæ™¯
/// 
/// - **åˆ†å¸ƒå¼å¯†é’¥ç®¡ç†**: åŠ å¯†å¯†é’¥çš„å®‰å…¨å­˜å‚¨å’Œä½¿ç”¨
/// - **å¤šæ–¹è®¡ç®—è¾“å…¥**: å„æ–¹è¾“å…¥æ•°æ®çš„éšç§ä¿æŠ¤
/// - **åŒºå—é“¾æ²»ç†**: å¤šç­¾é’±åŒ…å’Œå»ä¸­å¿ƒåŒ–å†³ç­–
/// - **å…³é”®åŸºç¡€è®¾æ–½**: æ ¸è®¾æ–½ã€é‡‘èç³»ç»Ÿçš„å®‰å…¨æ§åˆ¶
pub fn secret_sharing_demo() -> Result<()> {
    println!("=== Shamir ç§˜å¯†åˆ†äº«æœºåˆ¶æ¼”ç¤º ===");
    
    // === åŸºæœ¬å‚æ•°è®¾ç½® ===
    let secret = 123456u64;
    let threshold = 3;      // é‡æ„é—¨é™ï¼šéœ€è¦è‡³å°‘3ä¸ªåˆ†äº«
    let total_parties = 5;  // æ€»å‚ä¸æ–¹ï¼šç”Ÿæˆ5ä¸ªåˆ†äº«
    
    println!("ğŸ” ç§˜å¯†åˆ†äº«é…ç½®:");
    println!("  ç§˜å¯†å€¼: {} (éœ€è¦ä¿æŠ¤çš„æ•æ„Ÿæ•°æ®)", secret);
    println!("  é—¨é™æ–¹æ¡ˆ: {}-out-of-{}", threshold, total_parties);
    println!("  é‡æ„é—¨é™: {} (æœ€å°‘éœ€è¦{}ä¸ªå‚ä¸æ–¹åˆä½œ)", threshold, threshold);
    println!("  å‚ä¸æ–¹æ€»æ•°: {} (æ€»å…±{}æ–¹æŒæœ‰åˆ†äº«)", total_parties, total_parties);
    println!("  å®¹é”™èƒ½åŠ›: å¯å®¹å¿{}æ–¹ç¦»çº¿", total_parties - threshold);
    
    // === æ­¥éª¤1: ç§˜å¯†åˆ†äº«ç”Ÿæˆ ===
    println!("\nğŸ“¤ æ­¥éª¤1: ç”Ÿæˆç§˜å¯†åˆ†äº«");
    println!("  ä½¿ç”¨ {}-1 = {} æ¬¡å¤šé¡¹å¼è¿›è¡Œåˆ†äº«", threshold, threshold - 1);
    
    let shares = ShamirSecretSharing::share(&secret, threshold, total_parties)?;
    
    println!("  âœ… æˆåŠŸç”Ÿæˆ {} ä¸ªç§˜å¯†åˆ†äº«", shares.len());
    
    // å±•ç¤ºåˆ†äº«ç»“æ„ï¼ˆæ³¨æ„ï¼šå®é™…åº”ç”¨ä¸­ä¸åº”æ³„éœ²åˆ†äº«å€¼ï¼‰
    println!("  ğŸ“Š åˆ†äº«åˆ†å¸ƒæƒ…å†µ:");
    for (i, share) in shares.iter().enumerate() {
        println!("    å‚ä¸æ–¹ {}: ç‚¹({}, ***) [xåæ ‡={}, yåæ ‡ä¿å¯†]", 
                i + 1, share.x, share.x);
    }
    
    // === æ­¥éª¤2: ç§˜å¯†é‡æ„æ¼”ç¤º ===
    println!("\nğŸ“¥ æ­¥éª¤2: ä½¿ç”¨é—¨é™æ•°é‡çš„åˆ†äº«é‡æ„ç§˜å¯†");
    println!("  é€‰æ‹©å‰ {} ä¸ªåˆ†äº«è¿›è¡Œé‡æ„", threshold);
    
    let reconstruction_shares = &shares[0..threshold];
    println!("  ä½¿ç”¨åˆ†äº«: {:?}", 
            reconstruction_shares.iter().map(|s| s.x).collect::<Vec<_>>());
    
    let reconstructed = ShamirSecretSharing::reconstruct(reconstruction_shares, threshold)?;
    
    println!("  ğŸ”“ é‡æ„ç»“æœ: {}", reconstructed);
    println!("  ğŸ“Š é‡æ„éªŒè¯: {} == {} -> {}", 
            secret, reconstructed, secret == reconstructed);
    
    assert_eq!(secret, reconstructed, "ç§˜å¯†é‡æ„å¤±è´¥");
    println!("  âœ… ç§˜å¯†é‡æ„æˆåŠŸ");
    
    // === æ­¥éª¤3: éšç§æ€§éªŒè¯ ===
    println!("\nğŸ›¡ï¸ æ­¥éª¤3: éšç§æ€§éªŒè¯");
    println!("  æµ‹è¯•å°‘äºé—¨é™çš„åˆ†äº«æ— æ³•é‡æ„ç§˜å¯†");
    
    let insufficient_shares = &shares[0..threshold-1];
    println!("  ä½¿ç”¨ {} ä¸ªåˆ†äº«ï¼ˆå°‘äºé—¨é™ {}ï¼‰", insufficient_shares.len(), threshold);
    
    // æ³¨æ„ï¼šè¿™é‡Œæˆ‘ä»¬ä¸å®é™…å°è¯•é‡æ„ï¼Œå› ä¸ºä¼šå¤±è´¥
    // åœ¨å®é™…å®ç°ä¸­ï¼Œåº”è¯¥è¿”å›é”™è¯¯æˆ–éšæœºå€¼
    println!("  ğŸ’¡ ç†è®ºä¿è¯: {} ä¸ªåˆ†äº«æ— æ³•è·å¾—ç§˜å¯†çš„ä»»ä½•ä¿¡æ¯", threshold - 1);
    
    // === æ­¥éª¤4: åŒæ€æ€§è´¨æ¼”ç¤º ===
    println!("\nğŸ”„ æ­¥éª¤4: åŒæ€è¿ç®—æ¼”ç¤º");
    println!("  å±•ç¤ºç§˜å¯†åˆ†äº«çš„çº¿æ€§åŒæ€æ€§è´¨");
    
    let secret2 = 654321u64;
    println!("  ç¬¬äºŒä¸ªç§˜å¯†: {}", secret2);
    
    let shares2 = ShamirSecretSharing::share(&secret2, threshold, total_parties)?;
    println!("  ç”Ÿæˆç¬¬äºŒç»„åˆ†äº«å®Œæˆ");
    
    // åˆ†äº«çº§åˆ«çš„åŠ æ³•è¿ç®—
    println!("  æ‰§è¡Œåˆ†äº«çº§åˆ«çš„åŠ æ³•è¿ç®—...");
    let sum_shares: Vec<_> = shares.iter()
        .zip(shares2.iter())
        .map(|(s1, s2)| ShamirSecretSharing::add_shares(s1, s2))
        .collect::<Result<Vec<_>>>()?;
    
    println!("  âœ… åˆ†äº«åŠ æ³•å®Œæˆï¼Œç”Ÿæˆ {} ä¸ªå’Œåˆ†äº«", sum_shares.len());
    
    // é‡æ„åŠ æ³•ç»“æœ
    let computed_sum = ShamirSecretSharing::reconstruct(&sum_shares[0..threshold], threshold)?;
    let expected_sum = field_add(secret, secret2);
    
    println!("  ğŸ§® åŒæ€è¿ç®—éªŒè¯:");
    println!("    ç§˜å¯†1: {}", secret);
    println!("    ç§˜å¯†2: {}", secret2);
    println!("    æœŸæœ›å’Œ: {}", expected_sum);
    println!("    è®¡ç®—å’Œ: {}", computed_sum);
    println!("    éªŒè¯: {} == {} -> {}", 
            expected_sum, computed_sum, expected_sum == computed_sum);
    
    assert_eq!(computed_sum, expected_sum, "åŒæ€åŠ æ³•éªŒè¯å¤±è´¥");
    println!("  âœ… åŒæ€åŠ æ³•éªŒè¯æˆåŠŸ");
    
    // === æ­¥éª¤5: é²æ£’æ€§æ¼”ç¤º ===
    println!("\nğŸ”§ æ­¥éª¤5: å®¹é”™æ€§å’Œé²æ£’æ€§");
    
    // ä½¿ç”¨ä¸åŒçš„åˆ†äº«ç»„åˆé‡æ„
    println!("  æµ‹è¯•ä½¿ç”¨ä¸åŒåˆ†äº«ç»„åˆé‡æ„:");
    
    let test_combinations = vec![
        vec![0, 1, 2],  // å‰ä¸‰ä¸ªåˆ†äº«
        vec![1, 2, 3],  // ä¸­é—´ä¸‰ä¸ªåˆ†äº«
        vec![2, 3, 4],  // åä¸‰ä¸ªåˆ†äº«
    ];
    
    for (i, combination) in test_combinations.iter().enumerate() {
        let test_shares: Vec<_> = combination.iter()
            .map(|&idx| shares[idx].clone())
            .collect();
        
        let test_result = ShamirSecretSharing::reconstruct(&test_shares, threshold)?;
        
        println!("    ç»„åˆ {}: åˆ†äº«{:?} -> ç»“æœ {}", 
                i + 1, combination, test_result);
        assert_eq!(test_result, secret, "åˆ†äº«ç»„åˆ{}é‡æ„å¤±è´¥", i + 1);
    }
    
    println!("  âœ… æ‰€æœ‰åˆ†äº«ç»„åˆéƒ½èƒ½æ­£ç¡®é‡æ„ç§˜å¯†");
    
    // === å®‰å…¨æ€§å’Œåº”ç”¨æ€»ç»“ ===
    println!("\nğŸ“‹ Shamir ç§˜å¯†åˆ†äº«ç‰¹æ€§æ€»ç»“:");
    println!("  ğŸ”’ å®‰å…¨ç‰¹æ€§:");
    println!("    â€¢ ä¿¡æ¯è®ºå®‰å…¨: å¯¹è®¡ç®—æ— ç•Œæ•Œæ‰‹å®‰å…¨");
    println!("    â€¢ å®Œç¾ç§˜å¯†æ€§: å°‘äºé—¨é™çš„åˆ†äº«ä¸æ³„éœ²ä»»ä½•ä¿¡æ¯");
    println!("    â€¢ å¯éªŒè¯æ€§: å¯ä»¥æ£€æµ‹æ— æ•ˆæˆ–æŸåçš„åˆ†äº«");
    
    println!("  âš¡ æ€§èƒ½ç‰¹æ€§:");
    println!("    â€¢ åˆ†äº«ç”Ÿæˆ: O(n) æ—¶é—´å¤æ‚åº¦");
    println!("    â€¢ ç§˜å¯†é‡æ„: O(tÂ²) æ—¶é—´å¤æ‚åº¦ï¼ˆæ‹‰æ ¼æœ—æ—¥æ’å€¼ï¼‰");
    println!("    â€¢ å­˜å‚¨å¼€é”€: æ¯ä¸ªåˆ†äº«éœ€è¦ä¸¤ä¸ªåŸŸå…ƒç´ ");
    
    println!("  ğŸš€ å®é™…åº”ç”¨:");
    println!("    â€¢ å¤šæ–¹è®¡ç®—åè®®çš„è¾“å…¥å±‚");
    println!("    â€¢ åˆ†å¸ƒå¼å¯†é’¥ç®¡ç†ç³»ç»Ÿ");
    println!("    â€¢ åŒºå—é“¾å¤šç­¾åæ–¹æ¡ˆ");
    println!("    â€¢ å®¹é”™å­˜å‚¨ç³»ç»Ÿ");
    
    println!("\nâœ… Shamir ç§˜å¯†åˆ†äº«æ¼”ç¤ºå®Œæˆ");
    println!("ğŸ’¡ æ ¸å¿ƒä»·å€¼: åœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸­æä¾›æ•°å­¦ä¸Šå¯è¯æ˜çš„ç§˜å¯†ä¿æŠ¤\n");
    
    Ok(())
}

/// Beaver ä¸‰å…ƒç»„å®‰å…¨ä¹˜æ³•æœºåˆ¶æ¼”ç¤º
/// 
/// ## ğŸ¯ åŠŸèƒ½æ¦‚è¿°
/// 
/// æœ¬å‡½æ•°è¯¦ç»†æ¼”ç¤º Beaver ä¸‰å…ƒç»„æŠ€æœ¯ï¼Œè¿™æ˜¯å®‰å…¨å¤šæ–¹è®¡ç®—ä¸­å®ç°é«˜æ•ˆä¹˜æ³•è¿ç®—çš„æ ¸å¿ƒæŠ€æœ¯ã€‚
/// Beaver ä¸‰å…ƒç»„é€šè¿‡é¢„å¤„ç†çš„æ–¹å¼ï¼Œå°†å¤æ‚çš„å®‰å…¨ä¹˜æ³•é—®é¢˜è½¬åŒ–ä¸ºç®€å•çš„çº¿æ€§è¿ç®—ã€‚
/// 
/// ## ğŸ“š æŠ€æœ¯åŸç†
/// 
/// ### Beaver ä¸‰å…ƒç»„çš„å®šä¹‰
/// 
/// Beaver ä¸‰å…ƒç»„æ˜¯æ»¡è¶³ c = a Ã— b çš„ä¸‰å…ƒç»„ (a, b, c)ï¼Œå…¶ä¸­ï¼š
/// - a, b: éšæœºé€‰æ‹©çš„æœ‰é™åŸŸå…ƒç´ 
/// - c: a å’Œ b çš„ä¹˜ç§¯ï¼Œåœ¨æœ‰é™åŸŸä¸­è®¡ç®—
/// - æ‰€æœ‰å€¼éƒ½ä»¥ç§˜å¯†åˆ†äº«çš„å½¢å¼åˆ†å‘ç»™å‚ä¸æ–¹
/// 
/// ### å®‰å…¨ä¹˜æ³•åè®®
/// 
/// ä½¿ç”¨ Beaver ä¸‰å…ƒç»„å®ç°å®‰å…¨ä¹˜æ³•çš„æ­¥éª¤ï¼š
/// 1. å„æ–¹æŒæœ‰ç§˜å¯†åˆ†äº« [x] å’Œ [y]ï¼ˆå¾…ä¹˜çš„å€¼ï¼‰
/// 2. å„æ–¹æŒæœ‰é¢„å¤„ç†çš„ Beaver ä¸‰å…ƒç»„ ([a], [b], [c])
/// 3. è®¡ç®—å¹¶å…¬å¼€ d = x - a å’Œ e = y - b
/// 4. è®¡ç®—ç»“æœï¼š[xy] = [c] + d[b] + e[a] + de
/// 
/// ### å®‰å…¨æ€§åˆ†æ
/// 
/// - **éšç§ä¿æŠ¤**: d å’Œ e çš„å…¬å¼€ä¸ä¼šæ³„éœ² x, y çš„ä¿¡æ¯ï¼ˆå› ä¸º a, b æ˜¯éšæœºçš„ï¼‰
/// - **æ­£ç¡®æ€§**: æ•°å­¦ä¸Šå¯è¯æ˜ç»“æœç­‰äº xy
/// - **é«˜æ•ˆæ€§**: åœ¨çº¿é˜¶æ®µåªéœ€è¦ä¸€è½®é€šä¿¡å’Œç®€å•è¿ç®—
/// 
/// ## ğŸš€ ä¼˜åŠ¿ç‰¹ç‚¹
/// 
/// 1. **é¢„å¤„ç†æ¨¡å¼**: ä¸‰å…ƒç»„å¯ä»¥æå‰ç”Ÿæˆï¼Œä¸ä¾èµ–å®é™…è¾“å…¥
/// 2. **é«˜æ•ˆåœ¨çº¿**: åœ¨çº¿é˜¶æ®µå¤æ‚åº¦æä½ï¼Œæ¥è¿‘æ˜æ–‡è®¡ç®—é€Ÿåº¦
/// 3. **å¯æ‰©å±•æ€§**: æ”¯æŒä»»æ„æ•°é‡çš„å‚ä¸æ–¹å’Œå¤æ‚è®¡ç®—
/// 4. **é€šç”¨æ€§**: å¯ä»¥ç»„åˆæ„å»ºä»»æ„çš„ç®—æœ¯ç”µè·¯
/// 
/// ## ğŸ’¡ åº”ç”¨åœºæ™¯
/// 
/// - **éšç§ä¿æŠ¤æœºå™¨å­¦ä¹ **: ç¥ç»ç½‘ç»œçš„çŸ©é˜µä¹˜æ³•è¿ç®—
/// - **é‡‘èè®¡ç®—**: å¤šæ–¹é£é™©è¯„ä¼°å’ŒæŠ•èµ„ç»„åˆä¼˜åŒ–
/// - **ç»Ÿè®¡åˆ†æ**: å¤šæºæ•°æ®çš„åæ–¹å·®å’Œç›¸å…³æ€§è®¡ç®—
/// - **ç§‘å­¦è®¡ç®—**: è”åˆç ”ç©¶ä¸­çš„æ•°å€¼æ¨¡æ‹Ÿ
pub fn beaver_triples_demo() -> Result<()> {
    println!("=== Beaver ä¸‰å…ƒç»„å®‰å…¨ä¹˜æ³•æ¼”ç¤º ===");
    
    // === é…ç½®åè®®å‚æ•° ===
    let party_count = 3;    // 3æ–¹åè®®
    let threshold = 2;      // 2-out-of-3 é—¨é™
    let party_id = 0;       // å½“å‰æ–¹ID
    
    println!("ğŸ”§ åè®®é…ç½®:");
    println!("  å‚ä¸æ–¹æ•°é‡: {} æ–¹", party_count);
    println!("  é—¨é™è®¾ç½®: {}-out-of-{}", threshold, party_count);
    println!("  å½“å‰æ–¹èº«ä»½: å‚ä¸æ–¹ {}", party_id);
    println!("  å®¹é”™èƒ½åŠ›: å¯å®¹å¿ {} æ–¹æ•…éšœ", party_count - threshold);
    
    // === æ­¥éª¤1: åˆ›å»ºå¯ä¿¡ç¬¬ä¸‰æ–¹ç”Ÿæˆå™¨ ===
    println!("\nâš™ï¸ æ­¥éª¤1: åˆ›å»º Beaver ä¸‰å…ƒç»„ç”Ÿæˆå™¨");
    println!("  ä½¿ç”¨å¯ä¿¡ç¬¬ä¸‰æ–¹æ¨¡å¼ï¼ˆé€‚ç”¨äºå—æ§ç¯å¢ƒï¼‰");
    
    let mut generator = TrustedPartyBeaverGenerator::new(
        party_count, 
        threshold, 
        party_id, 
        None  // ä½¿ç”¨é»˜è®¤å®‰å…¨å‚æ•°
    )?;
    
    println!("  âœ… å¯ä¿¡ç¬¬ä¸‰æ–¹ç”Ÿæˆå™¨åˆ›å»ºæˆåŠŸ");
    
    // === æ­¥éª¤2: ç”Ÿæˆ Beaver ä¸‰å…ƒç»„ ===
    println!("\nğŸ² æ­¥éª¤2: ç”Ÿæˆ Beaver ä¸‰å…ƒç»„");
    println!("  ç”Ÿæˆæ»¡è¶³ c = a Ã— b å…³ç³»çš„éšæœºä¸‰å…ƒç»„...");
    
    let beaver_triple = generator.generate_single()?;
    
    println!("  âœ… Beaver ä¸‰å…ƒç»„ç”ŸæˆæˆåŠŸ");
    println!("  ğŸ“Š ä¸‰å…ƒç»„ç»“æ„:");
    println!("    åˆ†äº«æ•°é‡: {} (æ¯ä¸ªå‚ä¸æ–¹ä¸€ä»½)", beaver_triple.shares.len());
    println!("    åˆ†äº«ç±»å‹: Shamir ç§˜å¯†åˆ†äº«");
    
    // === æ­¥éª¤3: éªŒè¯ä¸‰å…ƒç»„æœ‰æ•ˆæ€§ ===
    println!("\nğŸ” æ­¥éª¤3: éªŒè¯ä¸‰å…ƒç»„æœ‰æ•ˆæ€§");
    println!("  æ£€æŸ¥æ•°å­¦å…³ç³» c = a Ã— b æ˜¯å¦æˆç«‹...");
    
    let is_valid = generator.verify_triple(&beaver_triple)?;
    println!("  éªŒè¯ç»“æœ: {}", if is_valid { "âœ… æœ‰æ•ˆ" } else { "âŒ æ— æ•ˆ" });
    
    if !is_valid {
        println!("  âš ï¸ è­¦å‘Š: ä¸‰å…ƒç»„éªŒè¯å¤±è´¥ï¼Œå¯èƒ½å­˜åœ¨ç”Ÿæˆé”™è¯¯");
        println!("     åœ¨ç”Ÿäº§ç¯å¢ƒä¸­åº”è¯¥é‡æ–°ç”Ÿæˆæˆ–ä½¿ç”¨å¤‡ä»½ä¸‰å…ƒç»„");
    }
    
    // === æ­¥éª¤4: åˆ†æä¸‰å…ƒç»„ç»“æ„ ===
    println!("\nğŸ“‹ æ­¥éª¤4: åˆ†æä¸‰å…ƒç»„åˆ†äº«ç»“æ„");
    
    for (party_id, triple_share) in &beaver_triple.shares {
        println!("  ğŸ“ å‚ä¸æ–¹ {} çš„åˆ†äº«:", party_id);
        println!("    a åˆ†äº«: ç‚¹({}, ***) [x={}, yå€¼ä¿å¯†]", triple_share.a.x, triple_share.a.x);
        println!("    b åˆ†äº«: ç‚¹({}, ***) [x={}, yå€¼ä¿å¯†]", triple_share.b.x, triple_share.b.x);
        println!("    c åˆ†äº«: ç‚¹({}, ***) [x={}, yå€¼ä¿å¯†]", triple_share.c.x, triple_share.c.x);
        
        // æ£€æŸ¥åˆ†äº«çš„å†…éƒ¨ä¸€è‡´æ€§
        let consistency = triple_share.is_consistent();
        println!("    åˆ†äº«ä¸€è‡´æ€§: {}", if consistency { "âœ… ä¸€è‡´" } else { "âŒ ä¸ä¸€è‡´" });
    }
    
    // === æ­¥éª¤5: éªŒè¯åŸå§‹å€¼å…³ç³»ï¼ˆä»…ç”¨äºæ•™å­¦æ¼”ç¤ºï¼‰ ===
    println!("\nğŸ”“ æ­¥éª¤5: éªŒè¯åŸå§‹ä¸‰å…ƒç»„å…³ç³» (ä»…ä¾›æ•™å­¦)");
    
    if let Some((a, b, c)) = beaver_triple.original_values {
        println!("  åŸå§‹ä¸‰å…ƒç»„å€¼:");
        println!("    a = {} (ç¬¬ä¸€ä¸ªéšæœºå› å­)", a);
        println!("    b = {} (ç¬¬äºŒä¸ªéšæœºå› å­)", b);
        println!("    c = {} (è®¡ç®—å¾—å‡ºçš„ä¹˜ç§¯)", c);
        
        let computed_c = field_mul(a, b);
        println!("  æ•°å­¦éªŒè¯:");
        println!("    è®¡ç®— a Ã— b = {} Ã— {} = {}", a, b, computed_c);
        println!("    éªŒè¯ c = {} (æœŸæœ›å€¼)", c);
        
        if c == computed_c {
            println!("    âœ… æ•°å­¦å…³ç³»æ­£ç¡®: c = a Ã— b");
        } else {
            println!("    âŒ æ•°å­¦å…³ç³»é”™è¯¯: c â‰  a Ã— b");
            return Err(MpcError::ProtocolError("Beaver ä¸‰å…ƒç»„æ•°å­¦å…³ç³»éªŒè¯å¤±è´¥".to_string()));
        }
    } else {
        println!("  ğŸ’¡ åŸå§‹å€¼å·²å®‰å…¨åˆ é™¤ï¼ˆç¬¦åˆå®‰å…¨åè®®è¦æ±‚ï¼‰");
    }
    
    // === æ­¥éª¤6: å®‰å…¨ä¹˜æ³•åè®®æ¼”ç¤º ===
    println!("\nğŸ” æ­¥éª¤6: ä½¿ç”¨ Beaver ä¸‰å…ƒç»„è¿›è¡Œå®‰å…¨ä¹˜æ³•");
    
    if is_valid {
        // é€‰æ‹©ä¸¤ä¸ªå¾…ç›¸ä¹˜çš„ç§˜å¯†å€¼
        let x = 25u64;
        let y = 16u64;
        let expected_product = field_mul(x, y);
        
        println!("  ğŸ¯ ä¹˜æ³•ä»»åŠ¡:");
        println!("    ç§˜å¯†å€¼ x: {}", x);
        println!("    ç§˜å¯†å€¼ y: {}", y);
        println!("    æœŸæœ›ä¹˜ç§¯: {}", expected_product);
        
        // å°†ç§˜å¯†å€¼è½¬æ¢ä¸ºç§˜å¯†åˆ†äº«
        println!("  ğŸ“¤ åˆ›å»ºè¾“å…¥çš„ç§˜å¯†åˆ†äº«...");
        let x_shares = ShamirSecretSharing::share(&x, threshold, party_count)?;
        let y_shares = ShamirSecretSharing::share(&y, threshold, party_count)?;
        println!("    âœ… x å’Œ y çš„ç§˜å¯†åˆ†äº«åˆ›å»ºå®Œæˆ");
        
        // æ‰§è¡Œå®‰å…¨ä¹˜æ³•åè®®
        println!("  ğŸ§® æ‰§è¡Œ Beaver ä¸‰å…ƒç»„å®‰å…¨ä¹˜æ³•åè®®...");
        println!("    åè®®æ­¥éª¤:");
        println!("      1. è®¡ç®— d = x - a (åœ¨ç§˜å¯†åˆ†äº«ä¸Š)");
        println!("      2. è®¡ç®— e = y - b (åœ¨ç§˜å¯†åˆ†äº«ä¸Š)");
        println!("      3. é‡æ„å¹¶å…¬å¼€ d å’Œ e");
        println!("      4. è®¡ç®— [xy] = [c] + d[b] + e[a] + de");
        
        let result_shares = secure_multiply(&x_shares, &y_shares, &beaver_triple, threshold)?;
        println!("    âœ… å®‰å…¨ä¹˜æ³•åè®®æ‰§è¡Œå®Œæˆ");
        
        // é‡æ„æœ€ç»ˆç»“æœ
        println!("  ğŸ“¥ é‡æ„ä¹˜æ³•ç»“æœ...");
        let computed_result = ShamirSecretSharing::reconstruct(&result_shares[0..threshold], threshold)?;
        
        println!("  ğŸ‰ å®‰å…¨ä¹˜æ³•ç»“æœ:");
        println!("    è®¡ç®—ç»“æœ: {}", computed_result);
        println!("    æœŸæœ›ç»“æœ: {}", expected_product);
        println!("    éªŒè¯: {} == {} -> {}", 
                computed_result, expected_product, computed_result == expected_product);
        
        if computed_result == expected_product {
            println!("    âœ… å®‰å…¨ä¹˜æ³•ç»“æœå®Œå…¨æ­£ç¡®");
        } else {
            println!("    âŒ å®‰å…¨ä¹˜æ³•ç»“æœé”™è¯¯");
            return Err(MpcError::ProtocolError("å®‰å…¨ä¹˜æ³•ç»“æœéªŒè¯å¤±è´¥".to_string()));
        }
        
        // === æ€§èƒ½å’Œå®‰å…¨æ€§åˆ†æ ===
        println!("\nğŸ“Š æ€§èƒ½å’Œå®‰å…¨æ€§åˆ†æ:");
        println!("  âš¡ æ€§èƒ½ç‰¹ç‚¹:");
        println!("    â€¢ é¢„å¤„ç†é˜¶æ®µ: ä¸€æ¬¡æ€§ç”Ÿæˆï¼Œå¯é‡å¤ä½¿ç”¨");
        println!("    â€¢ åœ¨çº¿é˜¶æ®µ: ä»…éœ€1è½®é€šä¿¡ + ç®€å•è¿ç®—");
        println!("    â€¢ è®¡ç®—å¤æ‚åº¦: æ¥è¿‘æ˜æ–‡ä¹˜æ³•çš„æ€§èƒ½");
        
        println!("  ğŸ”’ å®‰å…¨ä¿è¯:");
        println!("    â€¢ éšç§ä¿æŠ¤: x, y å€¼å§‹ç»ˆä¿å¯†");
        println!("    â€¢ æ­£ç¡®æ€§: æ•°å­¦ä¸Šå¯è¯æ˜çš„æ­£ç¡®æ€§");
        println!("    â€¢ å¯éªŒè¯æ€§: å¯ä»¥éªŒè¯è®¡ç®—ç»“æœçš„æ­£ç¡®æ€§");
        
    } else {
        println!("  âš ï¸ è·³è¿‡å®‰å…¨ä¹˜æ³•æ¼”ç¤ºï¼ˆä¸‰å…ƒç»„éªŒè¯å¤±è´¥ï¼‰");
        println!("    åœ¨å®é™…åº”ç”¨ä¸­åº”è¯¥:");
        println!("      1. é‡æ–°ç”Ÿæˆä¸‰å…ƒç»„");
        println!("      2. ä½¿ç”¨å¤‡ä»½ä¸‰å…ƒç»„");
        println!("      3. æ£€æŸ¥ç”Ÿæˆå™¨é…ç½®");
    }
    
    // === å®é™…åº”ç”¨åœºæ™¯ ===
    println!("\nğŸš€ Beaver ä¸‰å…ƒç»„å®é™…åº”ç”¨:");
    println!("  ğŸ’¼ å•†ä¸šåº”ç”¨:");
    println!("    â€¢ è”åˆæŠ•èµ„ç»„åˆä¼˜åŒ–: å¤šå®¶é‡‘èæœºæ„åˆä½œè®¡ç®—æœ€ä¼˜é…ç½®");
    println!("    â€¢ ä¾›åº”é“¾é£é™©è¯„ä¼°: å¤šæ–¹åä½œè¯„ä¼°ä¾›åº”é“¾æ•´ä½“é£é™©");
    println!("    â€¢ å¸‚åœºè°ƒç ”åˆ†æ: å¤šä¼ä¸šè”åˆåˆ†æå¸‚åœºæ•°æ®");
    
    println!("  ğŸ¥ ç§‘ç ”åº”ç”¨:");
    println!("    â€¢ åŒ»ç–—æ•°æ®ç ”ç©¶: å¤šåŒ»é™¢è”åˆç ”ç©¶è€Œä¸æ³„éœ²æ‚£è€…ä¿¡æ¯");
    println!("    â€¢ åŸºå› æ•°æ®åˆ†æ: å¤šæœºæ„åä½œåŸºå› ç»„ç ”ç©¶");
    println!("    â€¢ æ°”å€™æ¨¡å‹è®¡ç®—: å¤šå›½åˆä½œæ°”å€™é¢„æµ‹æ¨¡å‹");
    
    println!("  ğŸ¤– æŠ€æœ¯åº”ç”¨:");
    println!("    â€¢ è”é‚¦å­¦ä¹ : å¤šæ–¹è”åˆè®­ç»ƒæœºå™¨å­¦ä¹ æ¨¡å‹");
    println!("    â€¢ éšç§ä¿æŠ¤æ¨è: å¤šå¹³å°åä½œæ¨èç³»ç»Ÿ");
    println!("    â€¢ å®‰å…¨å®¡è®¡: å¤šæ–¹åä½œå®‰å…¨å®¡è®¡è®¡ç®—");
    
    println!("\nâœ… Beaver ä¸‰å…ƒç»„æ¼”ç¤ºå®Œæˆ");
    println!("ğŸ’¡ æ ¸å¿ƒä»·å€¼: é«˜æ•ˆã€å®‰å…¨ã€å¯æ‰©å±•çš„å¤šæ–¹ä¹˜æ³•è¿ç®—è§£å†³æ–¹æ¡ˆ\n");
    
    Ok(())
}

/// å“ˆå¸Œæ‰¿è¯ºæ–¹æ¡ˆè¯¦ç»†æ¼”ç¤º
/// 
/// ## ğŸ¯ åŠŸèƒ½æ¦‚è¿°
/// 
/// æœ¬å‡½æ•°æ¼”ç¤ºå“ˆå¸Œæ‰¿è¯ºæ–¹æ¡ˆï¼Œè¿™æ˜¯å¯†ç å­¦ä¸­ä¸€ç§åŸºç¡€çš„æ‰¿è¯ºåŸè¯­ã€‚
/// æ‰¿è¯ºæ–¹æ¡ˆå…è®¸ä¸€æ–¹åœ¨ä¸æ³„éœ²ä¿¡æ¯çš„æƒ…å†µä¸‹æ‰¿è¯ºæŸä¸ªå€¼ï¼Œå¹¶åœ¨ç¨åé˜¶æ®µéªŒè¯æ‰¿è¯ºçš„æ­£ç¡®æ€§ã€‚
/// 
/// ## ğŸ“š ç†è®ºåŸºç¡€
/// 
/// ### æ‰¿è¯ºæ–¹æ¡ˆçš„å®šä¹‰
/// 
/// æ‰¿è¯ºæ–¹æ¡ˆåŒ…å«ä¸¤ä¸ªé˜¶æ®µï¼š
/// 1. **æ‰¿è¯ºé˜¶æ®µ**: æ‰¿è¯ºæ–¹é€‰æ‹©ç§˜å¯†å€¼ s å’Œéšæœºæ•° rï¼Œè®¡ç®—æ‰¿è¯ºå€¼ c = Commit(s, r)
/// 2. **æ­ç¤ºé˜¶æ®µ**: æ‰¿è¯ºæ–¹å…¬å¼€ s å’Œ rï¼ŒéªŒè¯æ–¹æ£€æŸ¥ c = Commit(s, r) æ˜¯å¦æˆç«‹
/// 
/// ### å®‰å…¨æ€§è´¨
/// 
/// æ‰¿è¯ºæ–¹æ¡ˆå¿…é¡»æ»¡è¶³ä¸¤ä¸ªå…³é”®æ€§è´¨ï¼š
/// 
/// 1. **éšè—æ€§ (Hiding)**: æ‰¿è¯ºå€¼ c ä¸æ³„éœ²å…³äºç§˜å¯†å€¼ s çš„ä»»ä½•ä¿¡æ¯
///    - å³ä½¿æ”»å‡»è€…æ‹¥æœ‰æ— é™è®¡ç®—èƒ½åŠ›ï¼Œä¹Ÿæ— æ³•ä» c æ¨æ–­å‡º s
///    - æ•°å­¦è¡¨ç¤º: Pr[s=0|c] = Pr[s=1|c] (å¯¹äºäºŒè¿›åˆ¶æƒ…å†µ)
/// 
/// 2. **ç»‘å®šæ€§ (Binding)**: æ‰¿è¯ºæ–¹æ— æ³•æ‰¾åˆ°ä¸¤ä¸ªä¸åŒçš„å€¼å¯¹åº”åŒä¸€ä¸ªæ‰¿è¯º
///    - å³æ— æ³•æ‰¾åˆ° (sâ‚,râ‚) â‰  (sâ‚‚,râ‚‚) ä½¿å¾— Commit(sâ‚,râ‚) = Commit(sâ‚‚,râ‚‚)
///    - åŸºäºå“ˆå¸Œå‡½æ•°çš„æŠ—ç¢°æ’æ€§è´¨
/// 
/// ### å“ˆå¸Œæ‰¿è¯ºçš„æ„é€ 
/// 
/// å“ˆå¸Œæ‰¿è¯ºä½¿ç”¨å¯†ç å­¦å“ˆå¸Œå‡½æ•° Hï¼š
/// - æ‰¿è¯º: c = H(s || r)  (s è¿æ¥ r åè®¡ç®—å“ˆå¸Œ)
/// - éªŒè¯: æ£€æŸ¥ c ?= H(s || r)
/// 
/// ## ğŸ”’ å®‰å…¨åˆ†æ
/// 
/// - **éšè—æ€§**: åŸºäºå“ˆå¸Œå‡½æ•°çš„å•å‘æ€§å’Œä¼ªéšæœºæ€§
/// - **ç»‘å®šæ€§**: åŸºäºå“ˆå¸Œå‡½æ•°çš„æŠ—ç¢°æ’æ€§
/// - **è®¡ç®—å®‰å…¨**: å¯¹è®¡ç®—å¤šé¡¹å¼æ—¶é—´æ•Œæ‰‹å®‰å…¨
/// 
/// ## ğŸš€ åº”ç”¨åœºæ™¯
/// 
/// - **æ‹å–åè®®**: å¯†å°ç«ä»·æ‹å–ä¸­çš„å‡ºä»·æ‰¿è¯º
/// - **æŠ•ç¥¨ç³»ç»Ÿ**: ç”µå­æŠ•ç¥¨ä¸­çš„é€‰ç¥¨æ‰¿è¯º
/// - **é›¶çŸ¥è¯†è¯æ˜**: ä½œä¸ºæ›´å¤æ‚åè®®çš„æ„å»ºå—
/// - **åŒºå—é“¾**: æäº¤-æ­ç¤ºæ¨¡å¼çš„æ™ºèƒ½åˆçº¦
/// - **å¤šæ–¹è®¡ç®—**: è¾“å…¥æ‰¿è¯ºå’Œç»“æœéªŒè¯
pub fn hash_commitment_demo() -> Result<()> {
    println!("=== å“ˆå¸Œæ‰¿è¯ºæ–¹æ¡ˆè¯¦ç»†æ¼”ç¤º ===");
    
    // === è®¾ç½®æ¼”ç¤ºå‚æ•° ===
    let secret_value = 42u64;      // è¦æ‰¿è¯ºçš„ç§˜å¯†å€¼
    let randomness = 123456u64;    // éšæœºæ•°ï¼ˆç¡®ä¿éšè—æ€§ï¼‰
    
    println!("ğŸ” æ‰¿è¯ºè®¾ç½®:");
    println!("  ç§˜å¯†å€¼: {} (éœ€è¦æ‰¿è¯ºçš„æ•æ„Ÿä¿¡æ¯)", secret_value);
    println!("  éšæœºæ•°: {} (ç¡®ä¿æ‰¿è¯ºçš„éšè—æ€§)", randomness);
    println!("  å“ˆå¸Œå‡½æ•°: SHA-256 (æä¾›å®‰å…¨ä¿è¯)");
    
    // === æ­¥éª¤1: åˆ›å»ºæ‰¿è¯º ===
    println!("\nğŸ“ æ­¥éª¤1: åˆ›å»ºå“ˆå¸Œæ‰¿è¯º");
    println!("  æ‰§è¡Œæ‰¿è¯ºè®¡ç®—: c = H(secret || randomness)");
    
    let commitment = HashCommitment::commit_u64(secret_value, randomness);
    
    println!("  âœ… æ‰¿è¯ºåˆ›å»ºå®Œæˆ");
    println!("  ğŸ“Š æ‰¿è¯ºä¿¡æ¯:");
    println!("    æ‰¿è¯ºå€¼é•¿åº¦: {} å­—èŠ‚", commitment.len());
    println!("    æ‰¿è¯ºå€¼(å‰8å­—èŠ‚): {:02x?}...", &commitment[0..8]);
    println!("    ğŸ’¡ å®Œæ•´æ‰¿è¯ºå€¼å¯ä»¥å®‰å…¨å…¬å¼€");
    
    // === æ­¥éª¤2: æ‰¿è¯ºéªŒè¯ï¼ˆæ­£ç¡®æƒ…å†µï¼‰ ===
    println!("\nğŸ” æ­¥éª¤2: æ‰¿è¯ºéªŒè¯ (æ­£ç¡®æ­ç¤º)");
    println!("  ä½¿ç”¨åŸå§‹ç§˜å¯†å€¼å’Œéšæœºæ•°è¿›è¡ŒéªŒè¯...");
    
    let is_valid = HashCommitment::verify_u64(&commitment, secret_value, randomness);
    
    println!("  éªŒè¯è¿‡ç¨‹:");
    println!("    1. é‡æ–°è®¡ç®—: c' = H({} || {})", secret_value, randomness);
    println!("    2. æ¯”è¾ƒç»“æœ: c' ?= c");
    println!("    3. éªŒè¯ç»“æœ: {}", if is_valid { "âœ… é€šè¿‡" } else { "âŒ å¤±è´¥" });
    
    assert!(is_valid, "æ­£ç¡®çš„æ‰¿è¯ºéªŒè¯åº”è¯¥é€šè¿‡");
    println!("  âœ… æ‰¿è¯ºéªŒè¯æˆåŠŸï¼Œè¯æ˜ç§˜å¯†å€¼ç¡®å®æ˜¯ {}", secret_value);
    
    // === æ­¥éª¤3: é”™è¯¯å€¼éªŒè¯ï¼ˆæ¼”ç¤ºç»‘å®šæ€§ï¼‰ ===
    println!("\nğŸš« æ­¥éª¤3: é”™è¯¯å€¼éªŒè¯ (æ¼”ç¤ºç»‘å®šæ€§)");
    
    let wrong_value = 99u64;
    println!("  å°è¯•ä½¿ç”¨é”™è¯¯çš„ç§˜å¯†å€¼: {}", wrong_value);
    println!("  (ä¿æŒéšæœºæ•°ä¸å˜: {})", randomness);
    
    let is_wrong_valid = HashCommitment::verify_u64(&commitment, wrong_value, randomness);
    
    println!("  éªŒè¯è¿‡ç¨‹:");
    println!("    1. è®¡ç®—: c'' = H({} || {})", wrong_value, randomness);
    println!("    2. æ¯”è¾ƒ: c'' ?= c");
    println!("    3. ç»“æœ: {}", if is_wrong_valid { "âŒ æ„å¤–é€šè¿‡" } else { "âœ… æ­£ç¡®æ‹’ç»" });
    
    assert!(!is_wrong_valid, "é”™è¯¯çš„å€¼åº”è¯¥è¢«æ‹’ç»");
    println!("  âœ… ç»‘å®šæ€§éªŒè¯ï¼šæ— æ³•ä½¿ç”¨é”™è¯¯å€¼é€šè¿‡éªŒè¯");
    
    // === æ­¥éª¤4: é”™è¯¯éšæœºæ•°éªŒè¯ ===
    println!("\nğŸ² æ­¥éª¤4: é”™è¯¯éšæœºæ•°éªŒè¯");
    
    let wrong_randomness = 654321u64;
    println!("  å°è¯•ä½¿ç”¨é”™è¯¯çš„éšæœºæ•°: {}", wrong_randomness);
    println!("  (ä¿æŒç§˜å¯†å€¼ä¸å˜: {})", secret_value);
    
    let is_wrong_rand_valid = HashCommitment::verify_u64(&commitment, secret_value, wrong_randomness);
    
    println!("  éªŒè¯ç»“æœ: {}", if is_wrong_rand_valid { "âŒ æ„å¤–é€šè¿‡" } else { "âœ… æ­£ç¡®æ‹’ç»" });
    assert!(!is_wrong_rand_valid, "é”™è¯¯çš„éšæœºæ•°åº”è¯¥è¢«æ‹’ç»");
    println!("  âœ… éšæœºæ•°ç»‘å®šæ€§éªŒè¯ï¼šå¿…é¡»ä½¿ç”¨æ­£ç¡®çš„éšæœºæ•°");
    
    // === æ­¥éª¤5: éšè—æ€§æ¼”ç¤º ===
    println!("\nğŸ”’ æ­¥éª¤5: éšè—æ€§ç‰¹æ€§æ¼”ç¤º");
    
    // åˆ›å»ºå¤šä¸ªä¸åŒå€¼çš„æ‰¿è¯º
    let test_values = vec![0u64, 1u64, 42u64, 100u64, 999999u64];
    let test_randomness = vec![111111u64, 222222u64, 333333u64, 444444u64, 555555u64];
    
    println!("  åˆ›å»ºå¤šä¸ªä¸åŒå€¼çš„æ‰¿è¯º:");
    
    let mut commitments = Vec::new();
    for (i, (&value, &rand)) in test_values.iter().zip(test_randomness.iter()).enumerate() {
        let comm = HashCommitment::commit_u64(value, rand);
        commitments.push(comm);
        println!("    æ‰¿è¯º {}: å€¼={}, éšæœºæ•°={}, æ‰¿è¯ºå€¼å‰4å­—èŠ‚={:02x?}", 
                i + 1, value, rand, &commitments[i][0..4]);
    }
    
    println!("  ğŸ’¡ è§‚å¯Ÿ: å³ä½¿çŸ¥é“æ‰€æœ‰æ‰¿è¯ºå€¼ï¼Œä¹Ÿæ— æ³•æ¨æ–­å‡ºåŸå§‹ç§˜å¯†å€¼");
    println!("     è¿™å±•ç¤ºäº†å“ˆå¸Œæ‰¿è¯ºçš„éšè—æ€§ç‰¹è´¨");
    
    // === æ­¥éª¤6: å®é™…åº”ç”¨åœºæ™¯æ¨¡æ‹Ÿ ===
    println!("\nğŸ¯ æ­¥éª¤6: å®é™…åº”ç”¨åœºæ™¯æ¨¡æ‹Ÿ");
    
    // æ¨¡æ‹Ÿå¯†å°ç«ä»·æ‹å–
    println!("  ğŸ“± åœºæ™¯: å¯†å°ç«ä»·æ‹å–");
    let auction_bids = vec![
        (100u64, 789012u64),  // ç«ä»·è€…A: 100å…ƒ
        (150u64, 345678u64),  // ç«ä»·è€…B: 150å…ƒ  
        (120u64, 901234u64),  // ç«ä»·è€…C: 120å…ƒ
    ];
    
    println!("    ç¬¬ä¸€é˜¶æ®µ - æäº¤æ‰¿è¯º:");
    let mut auction_commitments = Vec::new();
    for (i, &(bid, rand)) in auction_bids.iter().enumerate() {
        let comm = HashCommitment::commit_u64(bid, rand);
        auction_commitments.push(comm);
        println!("      ç«ä»·è€… {}: æäº¤æ‰¿è¯º {:02x?}...", 
                char::from(b'A' + i as u8), &comm[0..4]);
    }
    
    println!("    ç¬¬äºŒé˜¶æ®µ - æ­ç¤ºç«ä»·:");
    let mut revealed_bids = Vec::new();
    for (i, &(bid, rand)) in auction_bids.iter().enumerate() {
        let is_valid = HashCommitment::verify_u64(&auction_commitments[i], bid, rand);
        if is_valid {
            revealed_bids.push((i, bid));
            println!("      ç«ä»·è€… {}: ç«ä»· {}å…ƒ âœ… éªŒè¯é€šè¿‡", 
                    char::from(b'A' + i as u8), bid);
        } else {
            println!("      ç«ä»·è€… {}: âŒ éªŒè¯å¤±è´¥", char::from(b'A' + i as u8));
        }
    }
    
    // ç¡®å®šæ‹å–ç»“æœ
    if let Some((winner_idx, winning_bid)) = revealed_bids.iter().max_by_key(|(_, bid)| *bid) {
        println!("    ğŸ† æ‹å–ç»“æœ: ç«ä»·è€… {} ä»¥ {}å…ƒ è·èƒœ", 
                char::from(b'A' + *winner_idx as u8), winning_bid);
    }
    
    // === å®‰å…¨æ€§å’Œæ€§èƒ½åˆ†æ ===
    println!("\nğŸ“Š å“ˆå¸Œæ‰¿è¯ºç‰¹æ€§åˆ†æ:");
    
    println!("  ğŸ”’ å®‰å…¨ç‰¹æ€§:");
    println!("    â€¢ éšè—æ€§: æ‰¿è¯ºå€¼ä¸æ³„éœ²ç§˜å¯†ä¿¡æ¯");
    println!("    â€¢ ç»‘å®šæ€§: æ— æ³•æ›´æ”¹å·²æ‰¿è¯ºçš„å€¼");
    println!("    â€¢ æŠ—ç¯¡æ”¹: ä»»ä½•ä¿®æ”¹éƒ½ä¼šè¢«æ£€æµ‹åˆ°");
    println!("    â€¢ å¯éªŒè¯: ä»»ä½•äººéƒ½å¯ä»¥éªŒè¯æ‰¿è¯º");
    
    println!("  âš¡ æ€§èƒ½ç‰¹æ€§:");
    println!("    â€¢ æ‰¿è¯ºç”Ÿæˆ: O(1) æ—¶é—´ï¼Œä¸€æ¬¡å“ˆå¸Œè®¡ç®—");
    println!("    â€¢ éªŒè¯é€Ÿåº¦: O(1) æ—¶é—´ï¼Œä¸€æ¬¡å“ˆå¸Œè®¡ç®—");
    println!("    â€¢ å­˜å‚¨å¼€é”€: å›ºå®šå¤§å°ï¼ˆå“ˆå¸Œé•¿åº¦ï¼‰");
    println!("    â€¢ é€šä¿¡å¼€é”€: æœ€å°åŒ–ï¼Œåªéœ€ä¼ è¾“å“ˆå¸Œå€¼");
    
    println!("  ğŸš€ åº”ç”¨ä¼˜åŠ¿:");
    println!("    â€¢ ç®€å•é«˜æ•ˆ: å®ç°å’Œä½¿ç”¨éƒ½å¾ˆç®€å•");
    println!("    â€¢ æ ‡å‡†åŒ–: åŸºäºæˆç†Ÿçš„å“ˆå¸Œå‡½æ•°");
    println!("    â€¢ å¯ç»„åˆ: å¯ä»¥ä½œä¸ºå¤æ‚åè®®çš„æ„å»ºå—");
    println!("    â€¢ é€šç”¨æ€§: é€‚ç”¨äºå„ç§éœ€è¦æ‰¿è¯ºçš„åœºæ™¯");
    
    println!("\nâœ… å“ˆå¸Œæ‰¿è¯ºæ¼”ç¤ºå®Œæˆ");
    println!("ğŸ’¡ æ ¸å¿ƒä»·å€¼: ç®€å•ã€é«˜æ•ˆã€å®‰å…¨çš„æ•°å­—æ‰¿è¯ºè§£å†³æ–¹æ¡ˆ\n");
    
    Ok(())
}

/// Merkle æ ‘æ•°æ®å®Œæ•´æ€§éªŒè¯æ¼”ç¤º
/// 
/// ## ğŸ¯ åŠŸèƒ½æ¦‚è¿°
/// 
/// æœ¬å‡½æ•°æ¼”ç¤º Merkle æ ‘ï¼ˆé»˜å…‹å°”æ ‘ï¼‰çš„æ„å»ºã€è¯æ˜ç”Ÿæˆå’ŒéªŒè¯è¿‡ç¨‹ã€‚
/// Merkle æ ‘æ˜¯ä¸€ç§é‡è¦çš„å¯†ç å­¦æ•°æ®ç»“æ„ï¼Œå¹¿æ³›ç”¨äºåŒºå—é“¾ã€åˆ†å¸ƒå¼ç³»ç»Ÿå’Œæ•°æ®å®Œæ•´æ€§éªŒè¯ã€‚
/// 
/// ## ğŸ“š æŠ€æœ¯åŸç†
/// 
/// ### Merkle æ ‘çš„ç»“æ„
/// 
/// Merkle æ ‘æ˜¯ä¸€ç§äºŒå‰æ ‘ç»“æ„ï¼Œå…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š
/// - **å¶å­èŠ‚ç‚¹**: å­˜å‚¨æ•°æ®é¡¹çš„å“ˆå¸Œå€¼ H(data_i)
/// - **å†…éƒ¨èŠ‚ç‚¹**: å­˜å‚¨å­èŠ‚ç‚¹å“ˆå¸Œå€¼çš„å“ˆå¸Œ H(left || right)  
/// - **æ ¹èŠ‚ç‚¹**: æ ‘çš„é¡¶å±‚èŠ‚ç‚¹ï¼Œä»£è¡¨æ•´ä¸ªæ•°æ®é›†çš„"æŒ‡çº¹"
/// 
/// ### æ„å»ºè¿‡ç¨‹
/// 
/// 1. **å¶å­å±‚**: å¯¹æ¯ä¸ªæ•°æ®é¡¹è®¡ç®—å“ˆå¸Œå€¼
/// 2. **åˆå¹¶è¿‡ç¨‹**: ç›¸é‚»å¶å­èŠ‚ç‚¹çš„å“ˆå¸Œå€¼é…å¯¹å¹¶å†æ¬¡å“ˆå¸Œ
/// 3. **é€’å½’æ„å»º**: é‡å¤é…å¯¹å’Œå“ˆå¸Œç›´åˆ°åªå‰©ä¸€ä¸ªæ ¹èŠ‚ç‚¹
/// 4. **å¹³è¡¡å¤„ç†**: å¥‡æ•°èŠ‚ç‚¹æ—¶å¤åˆ¶æœ€åä¸€ä¸ªèŠ‚ç‚¹
/// 
/// ### åŒ…å«æ€§è¯æ˜ (Merkle Proof)
/// 
/// åŒ…å«æ€§è¯æ˜æ˜¯ä¸€ä¸ªè·¯å¾„ä¸Šçš„å“ˆå¸Œå€¼åˆ—è¡¨ï¼Œç”¨äºè¯æ˜æŸä¸ªæ•°æ®é¡¹ç¡®å®åŒ…å«åœ¨æ ‘ä¸­ï¼š
/// - **è¯æ˜è·¯å¾„**: ä»å¶å­èŠ‚ç‚¹åˆ°æ ¹èŠ‚ç‚¹çš„è·¯å¾„ä¸Šçš„å…„å¼ŸèŠ‚ç‚¹å“ˆå¸Œ
/// - **éªŒè¯è¿‡ç¨‹**: ä½¿ç”¨è¯æ˜è·¯å¾„é‡æ–°è®¡ç®—æ ¹å“ˆå¸Œå¹¶ä¸å·²çŸ¥æ ¹å“ˆå¸Œæ¯”è¾ƒ
/// - **å¯¹æ•°å¤æ‚åº¦**: è¯æ˜å¤§å°ä¸º O(log n)ï¼ŒéªŒè¯æ—¶é—´ä¸º O(log n)
/// 
/// ## ğŸ”’ å®‰å…¨æ€§åˆ†æ
/// 
/// - **å®Œæ•´æ€§**: ä»»ä½•æ•°æ®ä¿®æ”¹éƒ½ä¼šæ”¹å˜æ ¹å“ˆå¸Œ
/// - **ä¸å¯ä¼ªé€ **: åŸºäºå“ˆå¸Œå‡½æ•°çš„æŠ—ç¢°æ’æ€§è´¨
/// - **é«˜æ•ˆéªŒè¯**: æ— éœ€ä¸‹è½½å®Œæ•´æ•°æ®é›†å³å¯éªŒè¯
/// - **éšç§å‹å¥½**: éªŒè¯æ—¶ä¸æ³„éœ²å…¶ä»–æ•°æ®é¡¹ä¿¡æ¯
/// 
/// ## ğŸš€ åº”ç”¨åœºæ™¯
/// 
/// - **åŒºå—é“¾**: äº¤æ˜“æ•°æ®çš„å®Œæ•´æ€§è¯æ˜
/// - **åˆ†å¸ƒå¼å­˜å‚¨**: æ–‡ä»¶å®Œæ•´æ€§éªŒè¯ï¼ˆå¦‚ IPFSï¼‰
/// - **è½¯ä»¶æ›´æ–°**: å¢é‡æ›´æ–°çš„å®Œæ•´æ€§ä¿è¯
/// - **å®¡è®¡ç³»ç»Ÿ**: å¤§è§„æ¨¡æ•°æ®çš„é«˜æ•ˆå®¡è®¡
/// - **ç‰ˆæœ¬æ§åˆ¶**: Git ç­‰ç³»ç»Ÿçš„æ•°æ®ç»“æ„
pub fn merkle_tree_demo() -> Result<()> {
    println!("=== Merkle æ ‘æ•°æ®å®Œæ•´æ€§éªŒè¯æ¼”ç¤º ===");
    
    // === å‡†å¤‡æµ‹è¯•æ•°æ® ===
    let data_items = vec![
        b"Transaction-001: Alice -> Bob: 100 coins".to_vec(),
        b"Transaction-002: Bob -> Charlie: 50 coins".to_vec(), 
        b"Transaction-003: Charlie -> David: 25 coins".to_vec(),
        b"Transaction-004: David -> Alice: 75 coins".to_vec(),
    ];
    
    println!("ğŸ“„ å‡†å¤‡æµ‹è¯•æ•°æ®:");
    println!("  æ•°æ®é¡¹æ•°é‡: {}", data_items.len());
    println!("  æ•°æ®ç±»å‹: æ¨¡æ‹ŸåŒºå—é“¾äº¤æ˜“è®°å½•");
    
    for (i, item) in data_items.iter().enumerate() {
        println!("    [{}] {}", i, String::from_utf8_lossy(item));
    }
    
    // === æ­¥éª¤1: æ„å»º Merkle æ ‘ ===
    println!("\nğŸŒ³ æ­¥éª¤1: æ„å»º Merkle æ ‘");
    println!("  è®¡ç®—å¶å­èŠ‚ç‚¹å“ˆå¸Œ...");
    
    // æ˜¾ç¤ºå¶å­èŠ‚ç‚¹å“ˆå¸Œè®¡ç®—è¿‡ç¨‹
    for (i, item) in data_items.iter().enumerate() {
        // è¿™é‡Œæˆ‘ä»¬æ— æ³•ç›´æ¥è®¿é—®å†…éƒ¨å“ˆå¸Œï¼Œä½†å¯ä»¥è¯´æ˜è¿‡ç¨‹
        println!("    å¶å­ {}: H(data_{}) = H({:?}...)", i, i, &item[0..12]);
    }
    
    let merkle_tree = MerkleTree::new(&data_items)?;
    let root_hash = merkle_tree.get_root();
    
    println!("  âœ… Merkle æ ‘æ„å»ºå®Œæˆ");
    println!("  ğŸ“Š æ ‘ç»“æ„ä¿¡æ¯:");
    println!("    å¶å­èŠ‚ç‚¹æ•°: {}", data_items.len());
    println!("    æ ‘çš„æ·±åº¦: {} å±‚", (data_items.len() as f64).log2().ceil() as u32 + 1);
    println!("    æ ¹å“ˆå¸Œå€¼: {:02x?}... (å‰8å­—èŠ‚)", &root_hash[0..8]);
    
    // === æ­¥éª¤2: åŒ…å«æ€§è¯æ˜ç”Ÿæˆ ===
    println!("\nğŸ” æ­¥éª¤2: åŒ…å«æ€§è¯æ˜ç”Ÿæˆ");
    
    let prove_index = 1;  // è¯æ˜ç¬¬2ä¸ªäº¤æ˜“ï¼ˆç´¢å¼•1ï¼‰
    println!("  ç›®æ ‡æ•°æ®: ä¸ºç´¢å¼• {} çš„æ•°æ®é¡¹ç”ŸæˆåŒ…å«æ€§è¯æ˜", prove_index);
    println!("  è¯æ˜å†…å®¹: \"{}\"", String::from_utf8_lossy(&data_items[prove_index]));
    
    let proof = merkle_tree.generate_proof(prove_index)?;
    
    println!("  âœ… åŒ…å«æ€§è¯æ˜ç”Ÿæˆå®Œæˆ");
    println!("  ğŸ“‹ è¯æ˜ä¿¡æ¯:");
    println!("    è¯æ˜è·¯å¾„é•¿åº¦: {} ä¸ªå“ˆå¸Œå€¼", proof.siblings.len());
    println!("    è¯æ˜å¤§å°: {} å­—èŠ‚", proof.siblings.len() * 32); // å‡è®¾æ¯ä¸ªå“ˆå¸Œ32å­—èŠ‚
    
    // æ˜¾ç¤ºè¯æ˜è·¯å¾„ï¼ˆéƒ¨åˆ†ä¿¡æ¯ï¼‰
    for (i, hash) in proof.siblings.iter().enumerate() {
        println!("    è·¯å¾„ {}: {:02x?}... (å…„å¼ŸèŠ‚ç‚¹)", i, &hash[0..4]);
    }
    
    // === æ­¥éª¤3: åŒ…å«æ€§è¯æ˜éªŒè¯ ===
    println!("\nâœ… æ­¥éª¤3: åŒ…å«æ€§è¯æ˜éªŒè¯");
    println!("  éªŒè¯è¿‡ç¨‹: ä½¿ç”¨è¯æ˜è·¯å¾„é‡æ–°è®¡ç®—æ ¹å“ˆå¸Œ");
    
    let is_included = MerkleTree::verify_proof(
        root_hash,
        &data_items[prove_index],
        &proof
    )?;
    
    println!("  éªŒè¯æ­¥éª¤:");
    println!("    1. è®¡ç®—ç›®æ ‡æ•°æ®çš„å“ˆå¸Œå€¼");
    println!("    2. ä½¿ç”¨è¯æ˜è·¯å¾„é€å±‚å‘ä¸Šè®¡ç®—");
    println!("    3. å°†è®¡ç®—å¾—åˆ°çš„æ ¹å“ˆå¸Œä¸å·²çŸ¥æ ¹å“ˆå¸Œæ¯”è¾ƒ");
    
    println!("  ğŸ‰ éªŒè¯ç»“æœ: {}", if is_included { "âœ… åŒ…å«" } else { "âŒ ä¸åŒ…å«" });
    assert!(is_included, "åŒ…å«æ€§è¯æ˜éªŒè¯åº”è¯¥é€šè¿‡");
    
    println!("  âœ… æ•°æ®é¡¹ {} ç¡®å®åŒ…å«åœ¨ Merkle æ ‘ä¸­", prove_index);
    
    // === æ­¥éª¤4: éªŒè¯æ‰€æœ‰æ•°æ®é¡¹ ===
    println!("\nğŸ”„ æ­¥éª¤4: éªŒè¯æ‰€æœ‰æ•°æ®é¡¹çš„åŒ…å«æ€§");
    
    let mut all_verified = true;
    for i in 0..data_items.len() {
        let proof = merkle_tree.generate_proof(i)?;
        let is_valid = MerkleTree::verify_proof(root_hash, &data_items[i], &proof)?;
        
        println!("  æ•°æ®é¡¹ {}: {}", i, if is_valid { "âœ… éªŒè¯é€šè¿‡" } else { "âŒ éªŒè¯å¤±è´¥" });
        all_verified &= is_valid;
    }
    
    assert!(all_verified, "æ‰€æœ‰æ•°æ®é¡¹éƒ½åº”è¯¥é€šè¿‡éªŒè¯");
    println!("  ğŸ‰ æ‰€æœ‰æ•°æ®é¡¹éƒ½æˆåŠŸé€šè¿‡åŒ…å«æ€§éªŒè¯");
    
    // === æ­¥éª¤5: ç¯¡æ”¹æ£€æµ‹æ¼”ç¤º ===
    println!("\nğŸš« æ­¥éª¤5: æ•°æ®ç¯¡æ”¹æ£€æµ‹æ¼”ç¤º");
    
    // æ¨¡æ‹Ÿç¯¡æ”¹æ•°æ®
    let tampered_data = b"Transaction-002: Bob -> Mallory: 50 coins".to_vec(); // ç¯¡æ”¹æ”¶æ¬¾äºº
    println!("  åŸå§‹æ•°æ®: \"{}\"", String::from_utf8_lossy(&data_items[1]));
    println!("  ç¯¡æ”¹æ•°æ®: \"{}\"", String::from_utf8_lossy(&tampered_data));
    
    // ä½¿ç”¨åŸå§‹è¯æ˜éªŒè¯ç¯¡æ”¹æ•°æ®
    let tampered_proof = merkle_tree.generate_proof(1)?; // è·å–åŸå§‹ä½ç½®çš„è¯æ˜
    let tampered_valid = MerkleTree::verify_proof(root_hash, &tampered_data, &tampered_proof)?;
    
    println!("  ç¯¡æ”¹æ£€æµ‹ç»“æœ: {}", if tampered_valid { "âŒ æœªæ£€æµ‹åˆ°ç¯¡æ”¹" } else { "âœ… æˆåŠŸæ£€æµ‹åˆ°ç¯¡æ”¹" });
    assert!(!tampered_valid, "ç¯¡æ”¹çš„æ•°æ®åº”è¯¥æ— æ³•é€šè¿‡éªŒè¯");
    
    // === æ­¥éª¤6: æ€§èƒ½å’Œæ•ˆç‡åˆ†æ ===
    println!("\nğŸ“Š æ­¥éª¤6: æ€§èƒ½å’Œæ•ˆç‡åˆ†æ");
    
    // æ¨¡æ‹Ÿä¸åŒè§„æ¨¡çš„æ•°æ®é›†
    let test_sizes = vec![4, 16, 64, 256, 1024];
    
    println!("  ä¸åŒæ•°æ®é›†è§„æ¨¡çš„è¯æ˜å¤§å°åˆ†æ:");
    println!("  æ•°æ®é¡¹æ•° | è¯æ˜å¤§å° | æ ‘æ·±åº¦ | éªŒè¯å¤æ‚åº¦");
    println!("  ---------|----------|--------|----------");
    
    for &size in &test_sizes {
        let depth = (size as f64).log2().ceil() as u32;
        let proof_size = depth * 32; // æ¯ä¸ªå“ˆå¸Œ32å­—èŠ‚
        println!("  {:>8} | {:>6} B | {:>4} | O(log n)", size, proof_size, depth);
    }
    
    // === æ­¥éª¤7: å®é™…åº”ç”¨åœºæ™¯æ¨¡æ‹Ÿ ===
    println!("\nğŸ¯ æ­¥éª¤7: å®é™…åº”ç”¨åœºæ™¯æ¨¡æ‹Ÿ");
    
    // æ¨¡æ‹ŸåŒºå—é“¾è½»èŠ‚ç‚¹éªŒè¯
    println!("  ğŸ’° åœºæ™¯: åŒºå—é“¾è½»èŠ‚ç‚¹äº¤æ˜“éªŒè¯");
    println!("  é—®é¢˜: è½»èŠ‚ç‚¹å¦‚ä½•åœ¨ä¸ä¸‹è½½å®Œæ•´åŒºå—çš„æƒ…å†µä¸‹éªŒè¯äº¤æ˜“ï¼Ÿ");
    println!("  è§£å†³æ–¹æ¡ˆ: ä½¿ç”¨ Merkle è¯æ˜");
    
    let target_tx_index = 2;
    let tx_proof = merkle_tree.generate_proof(target_tx_index)?;
    
    println!("    1. è½»èŠ‚ç‚¹è¯·æ±‚äº¤æ˜“ {} çš„åŒ…å«æ€§è¯æ˜", target_tx_index);
    println!("    2. å…¨èŠ‚ç‚¹è¿”å›è¯æ˜è·¯å¾„ ({} ä¸ªå“ˆå¸Œå€¼)", tx_proof.siblings.len());
    println!("    3. è½»èŠ‚ç‚¹ä½¿ç”¨åŒºå—å¤´ä¸­çš„æ ¹å“ˆå¸ŒéªŒè¯");
    
    let verification_result = MerkleTree::verify_proof(root_hash, &data_items[target_tx_index], &tx_proof)?;
    println!("    4. éªŒè¯ç»“æœ: {}", if verification_result { "âœ… äº¤æ˜“æœ‰æ•ˆ" } else { "âŒ äº¤æ˜“æ— æ•ˆ" });
    
    println!("  ğŸ’¡ ä¼˜åŠ¿: èŠ‚çœå¸¦å®½å’Œå­˜å‚¨ï¼ŒO(log n) å¤æ‚åº¦");
    
    // === æ€»ç»“å’Œç‰¹æ€§åˆ†æ ===
    println!("\nğŸ“‹ Merkle æ ‘æŠ€æœ¯ç‰¹æ€§æ€»ç»“:");
    
    println!("  ğŸ”’ å®‰å…¨ç‰¹æ€§:");
    println!("    â€¢ æ•°æ®å®Œæ•´æ€§: ä»»ä½•ä¿®æ”¹éƒ½ä¼šæ”¹å˜æ ¹å“ˆå¸Œ");
    println!("    â€¢ ä¸å¯ä¼ªé€ : åŸºäºå“ˆå¸Œå‡½æ•°çš„æŠ—ç¢°æ’æ€§");
    println!("    â€¢ å¯éªŒè¯æ€§: é«˜æ•ˆçš„åŒ…å«æ€§è¯æ˜æœºåˆ¶");
    println!("    â€¢ é˜²ç¯¡æ”¹: è‡ªåŠ¨æ£€æµ‹æ•°æ®ä¿®æ”¹");
    
    println!("  âš¡ æ€§èƒ½ç‰¹æ€§:");
    println!("    â€¢ æ„å»ºå¤æ‚åº¦: O(n) æ—¶é—´å’Œç©ºé—´");
    println!("    â€¢ è¯æ˜å¤§å°: O(log n) å“ˆå¸Œå€¼");
    println!("    â€¢ éªŒè¯æ—¶é—´: O(log n) å“ˆå¸Œè®¡ç®—");
    println!("    â€¢ æ›´æ–°æ•ˆç‡: å±€éƒ¨æ›´æ–°ï¼Œä¸éœ€è¦é‡æ„æ•´æ ‘");
    
    println!("  ğŸš€ åº”ç”¨ä¼˜åŠ¿:");
    println!("    â€¢ å¯æ‰©å±•æ€§: æ”¯æŒå¤§è§„æ¨¡æ•°æ®é›†");
    println!("    â€¢ æ•ˆç‡æ€§: æ— éœ€ä¼ è¾“å®Œæ•´æ•°æ®");
    println!("    â€¢ æ ‡å‡†åŒ–: æˆç†Ÿçš„å¯†ç å­¦å·¥å…·");
    println!("    â€¢ é€šç”¨æ€§: é€‚ç”¨äºå„ç§å®Œæ•´æ€§éªŒè¯åœºæ™¯");
    
    println!("  ğŸ’¼ å®é™…åº”ç”¨:");
    println!("    â€¢ æ¯”ç‰¹å¸/ä»¥å¤ªåŠ: äº¤æ˜“å®Œæ•´æ€§éªŒè¯");
    println!("    â€¢ IPFS: åˆ†å¸ƒå¼æ–‡ä»¶å­˜å‚¨éªŒè¯");
    println!("    â€¢ Certificate Transparency: SSLè¯ä¹¦é€æ˜åº¦");
    println!("    â€¢ Git: ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿçš„æ•°æ®ç»“æ„");
    
    println!("\nâœ… Merkle æ ‘æ¼”ç¤ºå®Œæˆ");
    println!("ğŸ’¡ æ ¸å¿ƒä»·å€¼: é«˜æ•ˆã€å®‰å…¨ã€å¯æ‰©å±•çš„æ•°æ®å®Œæ•´æ€§éªŒè¯è§£å†³æ–¹æ¡ˆ\n");
    
    Ok(())
}

/// è¿è¡Œæ‰€æœ‰åŸºç¡€åŠŸèƒ½æ¼”ç¤ºçš„ä¸»æ§åˆ¶å‡½æ•°
/// 
/// ## ğŸ¯ æ¼”ç¤ºç›®æ ‡
/// 
/// æœ¬å‡½æ•°æŒ‰é€»è¾‘é¡ºåºè¿è¡Œæ‰€æœ‰åŸºç¡€åŠŸèƒ½æ¼”ç¤ºï¼Œä¸ºç”¨æˆ·æä¾›å®Œæ•´çš„ MPC API å­¦ä¹ ä½“éªŒã€‚
/// æ¯ä¸ªæ¼”ç¤ºéƒ½å»ºç«‹åœ¨å‰é¢çš„æ¦‚å¿µåŸºç¡€ä¸Šï¼Œå½¢æˆä¸€ä¸ªå®Œæ•´çš„çŸ¥è¯†ä½“ç³»ã€‚
/// 
/// ## ğŸ“š æ¼”ç¤ºé¡ºåºå’Œé€»è¾‘
/// 
/// 1. **æœ‰é™åŸŸè¿ç®—**: å»ºç«‹æ•°å­¦åŸºç¡€ï¼Œç†è§£æ‰€æœ‰è®¡ç®—çš„æ•°å­¦ç¯å¢ƒ
/// 2. **ç§˜å¯†åˆ†äº«**: å±•ç¤ºéšç§ä¿æŠ¤çš„åŸºæœ¬æœºåˆ¶å’Œåˆ†å¸ƒå¼è®¡ç®—åŸºç¡€
/// 3. **Beaver ä¸‰å…ƒç»„**: æ¼”ç¤ºé«˜çº§å®‰å…¨è®¡ç®—åè®®ï¼Œå»ºç«‹åœ¨ç§˜å¯†åˆ†äº«ä¹‹ä¸Š
/// 4. **å“ˆå¸Œæ‰¿è¯º**: å±•ç¤ºæ‰¿è¯ºæ–¹æ¡ˆï¼Œè¡¥å……å¯†ç å­¦å·¥å…·ç®±
/// 5. **Merkle æ ‘**: æ¼”ç¤ºæ•°æ®å®Œæ•´æ€§éªŒè¯ï¼Œå±•ç¤ºå¤§è§„æ¨¡åº”ç”¨æŠ€æœ¯
/// 
/// ## ğŸ“ å­¦ä¹ è·¯å¾„
/// 
/// - **åˆå­¦è€…**: é‡ç‚¹å…³æ³¨æ¦‚å¿µå’Œå®‰å…¨æ€§è´¨çš„ç†è§£
/// - **å¼€å‘è€…**: å…³æ³¨ API ä½¿ç”¨æ–¹æ³•å’Œé›†æˆæ¨¡å¼  
/// - **ç ”ç©¶è€…**: æ·±å…¥ç†è§£ç®—æ³•åŸç†å’Œæ€§èƒ½ç‰¹å¾
/// - **å·¥ç¨‹å¸ˆ**: å…³æ³¨å®é™…åº”ç”¨åœºæ™¯å’Œéƒ¨ç½²è€ƒè™‘
pub fn run_all_demos() -> Result<()> {
    println!("ğŸŒŸ === MPC API åŸºç¡€åŠŸèƒ½å…¨é¢æ¼”ç¤º ===");
    println!("ğŸ“š æœ¬æ¼”ç¤ºå°†å¸¦æ‚¨å®Œæ•´äº†è§£å®‰å…¨å¤šæ–¹è®¡ç®—çš„æ ¸å¿ƒæŠ€æœ¯");
    println!("â±ï¸  é¢„è®¡æ¼”ç¤ºæ—¶é—´: 5-10 åˆ†é’Ÿ");
    println!("ğŸ¯ é€‚åˆå¯¹è±¡: MPC åˆå­¦è€…ã€å¼€å‘è€…ã€ç ”ç©¶äººå‘˜\n");
    
    // === æ¼”ç¤º1: æœ‰é™åŸŸè¿ç®— ===
    println!("ğŸ”¢ å¼€å§‹ç¬¬1ä¸ªæ¼”ç¤º: æœ‰é™åŸŸè¿ç®—åŸºç¡€");
    println!("ğŸ’¡ å­¦ä¹ é‡ç‚¹: ç†è§£å¯†ç å­¦è®¡ç®—çš„æ•°å­¦åŸºç¡€\n");
    
    field_operations_demo()?;
    
    println!("â¸ï¸  ç¬¬1ä¸ªæ¼”ç¤ºå®Œæˆï¼ŒæŒ‰å›è½¦ç»§ç»­ä¸‹ä¸€ä¸ªæ¼”ç¤º...");
    println!("â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€");
    
    // === æ¼”ç¤º2: ç§˜å¯†åˆ†äº« ===
    println!("\nğŸ” å¼€å§‹ç¬¬2ä¸ªæ¼”ç¤º: Shamir ç§˜å¯†åˆ†äº«æœºåˆ¶");
    println!("ğŸ’¡ å­¦ä¹ é‡ç‚¹: ç†è§£éšç§ä¿æŠ¤å’Œåˆ†å¸ƒå¼è®¡ç®—çš„åŸºç¡€");
    println!("ğŸ”— ä¸å‰é¢çš„è”ç³»: åŸºäºæœ‰é™åŸŸè¿ç®—å®ç°å¤šé¡¹å¼æ’å€¼\n");
    
    secret_sharing_demo()?;
    
    println!("â¸ï¸  ç¬¬2ä¸ªæ¼”ç¤ºå®Œæˆï¼ŒæŒ‰å›è½¦ç»§ç»­ä¸‹ä¸€ä¸ªæ¼”ç¤º...");
    println!("â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€");
    
    // === æ¼”ç¤º3: Beaver ä¸‰å…ƒç»„ ===
    println!("\nğŸ² å¼€å§‹ç¬¬3ä¸ªæ¼”ç¤º: Beaver ä¸‰å…ƒç»„å®‰å…¨ä¹˜æ³•");
    println!("ğŸ’¡ å­¦ä¹ é‡ç‚¹: ç†è§£é«˜çº§å®‰å…¨è®¡ç®—åè®®çš„è®¾è®¡");
    println!("ğŸ”— ä¸å‰é¢çš„è”ç³»: åŸºäºç§˜å¯†åˆ†äº«å®ç°å®‰å…¨ä¹˜æ³•è¿ç®—\n");
    
    beaver_triples_demo()?;
    
    println!("â¸ï¸  ç¬¬3ä¸ªæ¼”ç¤ºå®Œæˆï¼ŒæŒ‰å›è½¦ç»§ç»­ä¸‹ä¸€ä¸ªæ¼”ç¤º...");
    println!("â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€");
    
    // === æ¼”ç¤º4: å“ˆå¸Œæ‰¿è¯º ===
    println!("\nğŸ“ å¼€å§‹ç¬¬4ä¸ªæ¼”ç¤º: å“ˆå¸Œæ‰¿è¯ºæ–¹æ¡ˆ");
    println!("ğŸ’¡ å­¦ä¹ é‡ç‚¹: ç†è§£æ‰¿è¯ºæ–¹æ¡ˆåœ¨å¯†ç å­¦åè®®ä¸­çš„ä½œç”¨");
    println!("ğŸ”— ä¸å‰é¢çš„è”ç³»: ä¸º MPC åè®®æä¾›è¾“å…¥æ‰¿è¯ºå’ŒéªŒè¯èƒ½åŠ›\n");
    
    hash_commitment_demo()?;
    
    println!("â¸ï¸  ç¬¬4ä¸ªæ¼”ç¤ºå®Œæˆï¼ŒæŒ‰å›è½¦ç»§ç»­æœ€åä¸€ä¸ªæ¼”ç¤º...");
    println!("â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€");
    
    // === æ¼”ç¤º5: Merkle æ ‘ ===
    println!("\nğŸŒ³ å¼€å§‹ç¬¬5ä¸ªæ¼”ç¤º: Merkle æ ‘æ•°æ®å®Œæ•´æ€§éªŒè¯");
    println!("ğŸ’¡ å­¦ä¹ é‡ç‚¹: ç†è§£å¤§è§„æ¨¡æ•°æ®çš„é«˜æ•ˆå®Œæ•´æ€§éªŒè¯");
    println!("ğŸ”— ä¸å‰é¢çš„è”ç³»: ä¸º MPC åº”ç”¨æä¾›æ•°æ®å®Œæ•´æ€§ä¿è¯\n");
    
    merkle_tree_demo()?;
    
    // === æ¼”ç¤ºæ€»ç»“ ===
    println!("â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€");
    println!("ğŸ‰ === æ‰€æœ‰åŸºç¡€åŠŸèƒ½æ¼”ç¤ºæˆåŠŸå®Œæˆï¼ ===");
    
    println!("\nğŸ“Š æ¼”ç¤ºå†…å®¹å›é¡¾:");
    println!("  1ï¸âƒ£ æœ‰é™åŸŸè¿ç®— - å¯†ç å­¦è®¡ç®—çš„æ•°å­¦åŸºç¡€");
    println!("     âœ“ æ¨¡è¿ç®—ã€é€†å…ƒè®¡ç®—ã€ä»£æ•°æ€§è´¨éªŒè¯");
    println!("     âœ“ ä¸ºæ‰€æœ‰ä¸Šå±‚åè®®æä¾›æ•°å­¦æ”¯æ’‘");
    
    println!("  2ï¸âƒ£ Shamir ç§˜å¯†åˆ†äº« - éšç§ä¿æŠ¤çš„æ ¸å¿ƒæœºåˆ¶");
    println!("     âœ“ é—¨é™é‡æ„ã€åŒæ€è¿ç®—ã€å®¹é”™æ€§éªŒè¯");
    println!("     âœ“ åˆ†å¸ƒå¼è®¡ç®—å’Œéšç§ä¿æŠ¤çš„åŸºç¡€æŠ€æœ¯");
    
    println!("  3ï¸âƒ£ Beaver ä¸‰å…ƒç»„ - é«˜æ•ˆå®‰å…¨ä¹˜æ³•åè®®");
    println!("     âœ“ é¢„å¤„ç†æ¨¡å¼ã€å®‰å…¨ä¹˜æ³•ã€æ€§èƒ½ä¼˜åŒ–");
    println!("     âœ“ å¤æ‚å®‰å…¨è®¡ç®—åè®®çš„æ ¸å¿ƒæ„å»ºå—");
    
    println!("  4ï¸âƒ£ å“ˆå¸Œæ‰¿è¯ºæ–¹æ¡ˆ - ç®€å•é«˜æ•ˆçš„æ‰¿è¯ºåŸè¯­");
    println!("     âœ“ éšè—æ€§ã€ç»‘å®šæ€§ã€å®é™…åº”ç”¨åœºæ™¯");
    println!("     âœ“ ä¸ºåè®®æä¾›è¾“å…¥æ‰¿è¯ºå’ŒéªŒè¯èƒ½åŠ›");
    
    println!("  5ï¸âƒ£ Merkle æ ‘ - å¯æ‰©å±•çš„æ•°æ®å®Œæ•´æ€§éªŒè¯");
    println!("     âœ“ åŒ…å«æ€§è¯æ˜ã€ç¯¡æ”¹æ£€æµ‹ã€æ•ˆç‡åˆ†æ");
    println!("     âœ“ å¤§è§„æ¨¡åº”ç”¨ä¸­çš„æ•°æ®å®Œæ•´æ€§ä¿è¯");
    
    println!("\nğŸ”— æŠ€æœ¯å…³è”å›¾:");
    println!("  æœ‰é™åŸŸè¿ç®— â† æ‰€æœ‰å¯†ç å­¦æ“ä½œçš„åŸºç¡€");
    println!("       â†“");
    println!("  ç§˜å¯†åˆ†äº« â† éšç§ä¿æŠ¤è®¡ç®—çš„æ ¸å¿ƒ");
    println!("       â†“");
    println!("  Beaver ä¸‰å…ƒç»„ â† é«˜çº§å®‰å…¨è®¡ç®—åè®®");
    println!("       â†“");
    println!("  å“ˆå¸Œæ‰¿è¯º + Merkle æ ‘ â† è¾…åŠ©æŠ€æœ¯å’Œå®Œæ•´æ€§ä¿è¯");
    
    println!("\nğŸš€ ä¸‹ä¸€æ­¥å­¦ä¹ å»ºè®®:");
    println!("  ğŸ“– æ·±å…¥å­¦ä¹ :");
    println!("    â€¢ é˜…è¯» examples/complete_api_usage_guide.rs äº†è§£å®Œæ•´ API");
    println!("    â€¢ ç ”ç©¶ examples/beaver_triples_trusted_party_example.rs äº†è§£ç”Ÿäº§çº§å®ç°");
    println!("    â€¢ æ¢ç´¢ examples/advanced_protocols_guide.rs å­¦ä¹ é«˜çº§åè®®");
    
    println!("  ğŸ› ï¸ å®è·µç»ƒä¹ :");
    println!("    â€¢ å°è¯•ä¿®æ”¹å‚æ•°ï¼ˆé—¨é™å€¼ã€å‚ä¸æ–¹æ•°é‡ç­‰ï¼‰è§‚å¯Ÿå½±å“");
    println!("    â€¢ ç»„åˆä¸åŒæŠ€æœ¯å®ç°è‡ªå®šä¹‰åè®®");
    println!("    â€¢ æµ‹é‡å’Œä¼˜åŒ–æ€§èƒ½ç‰¹å¾");
    
    println!("  ğŸ¢ åº”ç”¨å¼€å‘:");
    println!("    â€¢ åˆ†ææ‚¨çš„åº”ç”¨åœºæ™¯éœ€æ±‚");
    println!("    â€¢ é€‰æ‹©åˆé€‚çš„æŠ€æœ¯ç»„åˆ");
    println!("    â€¢ è€ƒè™‘å®‰å…¨æ€§å’Œæ€§èƒ½å¹³è¡¡");
    
    println!("\nğŸ’¡ æ ¸å¿ƒæ”¶è·:");
    println!("  âœ“ MPC ä¸æ˜¯å•ä¸€æŠ€æœ¯ï¼Œè€Œæ˜¯å¤šç§å¯†ç å­¦æŠ€æœ¯çš„æœ‰æœºç»“åˆ");
    println!("  âœ“ æ¯ç§æŠ€æœ¯éƒ½æœ‰å…¶ç‰¹å®šçš„åº”ç”¨åœºæ™¯å’Œæ€§èƒ½ç‰¹ç‚¹");
    println!("  âœ“ å®é™…åº”ç”¨éœ€è¦æ ¹æ®éœ€æ±‚é€‰æ‹©å’Œç»„åˆæŠ€æœ¯");
    println!("  âœ“ å®‰å…¨æ€§ã€æ€§èƒ½å’Œå¯ç”¨æ€§éœ€è¦ç»¼åˆè€ƒè™‘");
    
    println!("\nğŸ“ æ­å–œæ‚¨å®Œæˆäº† MPC API åŸºç¡€åŠŸèƒ½çš„å®Œæ•´å­¦ä¹ ï¼");
    println!("ğŸŒŸ æ‚¨ç°åœ¨å·²ç»å…·å¤‡äº†å¼€å‘å®‰å…¨å¤šæ–¹è®¡ç®—åº”ç”¨çš„åŸºç¡€çŸ¥è¯†ã€‚");
    
    Ok(())
}

#[cfg(test)]
mod tests {
    use super::*;
    
    #[test]
    fn test_field_operations_demo() {
        field_operations_demo().unwrap();
    }
    
    #[test]
    fn test_secret_sharing_demo() {
        secret_sharing_demo().unwrap();
    }
    
    #[test]
    fn test_beaver_triples_demo() {
        beaver_triples_demo().unwrap();
    }
    
    #[test]
    fn test_hash_commitment_demo() {
        hash_commitment_demo().unwrap();
    }
    
    #[test]
    fn test_merkle_tree_demo() {
        merkle_tree_demo().unwrap();
    }
}

// å¦‚æœç›´æ¥è¿è¡Œæ­¤æ–‡ä»¶ï¼Œæ‰§è¡Œæ‰€æœ‰æ¼”ç¤º
fn main() -> Result<()> {
    run_all_demos()
}